(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["vis-three~f12e8e7e"],{2209:function(e,t,n){"use strict";n.d(t,"a",(function(){return ee})),n.d(t,"b",(function(){return Oa})),n.d(t,"c",(function(){return fa})),n.d(t,"d",(function(){return Ia})),n.d(t,"e",(function(){return va})),n.d(t,"f",(function(){return qe}));var r=n("5a89"),s=n("ef20"),i=n("32d9"),o=n("93e9"),a=n("b1f1"),c=n("e642"),l=n("4086"),h=n("2132"),d=n("34ad"),p=n("0ca5"),u=n("755e"),m=n("b57b"),g=n("e126"),f=n("4425"),E=n("ecc8"),y=(n("85ce"),n("32ab")),v=n("22b5"),b=n("3851"),M=n.n(b),S=n("1b53"),w=n("ab70"),T=n("9f13"),x=n("f7dd"),R=n("9ab2"),O=n("aea1"),C=Object.defineProperty,L=(e,t,n)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,A=(e,t,n)=>(L(e,"symbol"!==typeof t?t+"":t,n),n);class I{constructor(){A(this,"listeners",new Map)}addEventListener(e,t){const n=this.listeners;n.has(e)||n.set(e,new Set),n.get(e).add(t)}hasEventListener(e,t){const n=this.listeners;return!!n.has(e)&&n.get(e).has(t)}removeEventListener(e,t){const n=this.listeners;n.has(e)&&n.get(e).has(t)&&n.get(e).delete(t)}dispatchEvent(e){var t;const n=e.type,r=this.listeners;if(r.has(n))try{null==(t=r.get(n))||t.forEach(t=>{t.call(this,e)})}catch(s){console.error(s)}}clear(){this.listeners.clear()}useful(){return Boolean([...this.listeners.keys()].length)}once(e,t){const n=function(r){t.call(this,r),this.removeEventListener(e,n)};this.addEventListener(e,n)}emit(e,t={}){var n;const r=this.listeners;if(r.has(e))try{null==(n=r.get(e))||n.forEach(e=>{e.call(this,t)})}catch(s){console.error(s)}}on(e,t){this.addEventListener(e,t)}has(e,t){return this.hasEventListener(e,t)}off(e,t){if(t)this.removeEventListener(e,t);else{const t=this.listeners;if(!t.has(e))return;t.delete(e)}}}class D extends I{constructor(e=0){super(),A(this,"clock",new r["s"]),A(this,"animationFrame",-1),A(this,"fps",0),A(this,"timer",null),A(this,"playFun",()=>{}),A(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})}),A(this,"play",()=>{this.hasRendering()?console.warn("render manager is rendering."):(this.dispatchEvent({type:"play"}),this.playFun())}),A(this,"stop",()=>{-1!==this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})}),A(this,"hasRendering",()=>Boolean(-1!==this.animationFrame||this.timer)),A(this,"hasVaildRender",()=>this.useful()),this.setFPS(e)}setFPS(e){return-1!==this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const P=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new D,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class j extends I{constructor(e,t){super(),A(this,"object"),A(this,"domElement"),A(this,"enabled",!0),A(this,"target",new r["Kc"]),A(this,"minDistance",0),A(this,"maxDistance",1/0),A(this,"minZoom",0),A(this,"maxZoom",1/0),A(this,"minPolarAngle",0),A(this,"maxPolarAngle",Math.PI),A(this,"minAzimuthAngle",-1/0),A(this,"maxAzimuthAngle",1/0),A(this,"enableDamping",!1),A(this,"dampingFactor",.05),A(this,"enableZoom",!0),A(this,"zoomSpeed",1),A(this,"enableRotate",!0),A(this,"rotateSpeed",1),A(this,"enablePan",!0),A(this,"panSpeed",1),A(this,"screenSpacePanning",!0),A(this,"keyPanSpeed",7),A(this,"autoRotate",!1),A(this,"autoRotateSpeed",2),A(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),A(this,"mouseButtons",{LEFT:null,MIDDLE:r["lb"].DOLLY,RIGHT:r["lb"].ROTATE}),A(this,"touches",{ONE:r["yc"].ROTATE,TWO:r["yc"].DOLLY_PAN}),A(this,"target0"),A(this,"position0"),A(this,"zoom0"),A(this,"_domElementKeyEvents",null),A(this,"spherical"),A(this,"reset"),A(this,"update"),A(this,"onContextMenu"),A(this,"onPointerDown"),A(this,"onPointerCancel"),A(this,"onMouseWheel"),A(this,"onPointerMove"),A(this,"onPointerUp"),A(this,"onKeyDown"),this.object=e||new r["Lb"],this.domElement=t||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const e=new r["Kc"],t=(new r["Tb"]).setFromUnitVectors(this.object.up,new r["Kc"](0,1,0)),d=t.clone().invert(),p=new r["Kc"],u=new r["Tb"],m=2*Math.PI;return()=>{const r=this.object.position;e.copy(r).sub(this.target),e.applyQuaternion(t),o.setFromVector3(e),this.autoRotate&&s===n.NONE&&T(S()),this.enableDamping?(o.theta+=a.theta*this.dampingFactor,o.phi+=a.phi*this.dampingFactor):(o.theta+=a.theta,o.phi+=a.phi);let g=this.minAzimuthAngle,f=this.maxAzimuthAngle;return isFinite(g)&&isFinite(f)&&(g<-Math.PI?g+=m:g>Math.PI&&(g-=m),f<-Math.PI?f+=m:f>Math.PI&&(f-=m),o.theta=g<=f?Math.max(g,Math.min(f,o.theta)):o.theta>(g+f)/2?Math.max(g,o.theta):Math.min(f,o.theta)),o.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=c,o.radius=Math.max(this.minDistance,Math.min(this.maxDistance,o.radius)),!0===this.enableDamping?this.target.addScaledVector(l,this.dampingFactor):this.target.add(l),e.setFromSpherical(o),e.applyQuaternion(d),r.copy(this.target).add(e),this.object.lookAt(this.target),!0===this.enableDamping?(a.theta*=1-this.dampingFactor,a.phi*=1-this.dampingFactor,l.multiplyScalar(1-this.dampingFactor)):(a.set(0,0,0),l.set(0,0,0)),c=1,!!(h||p.distanceToSquared(this.object.position)>i||8*(1-u.dot(this.object.quaternion))>i)&&(this.dispatchEvent({type:"change"}),p.copy(this.object.position),u.copy(this.object.quaternion),h=!1,!0)}})();const n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=n.NONE;const i=1e-6,o=new r["tc"],a=new r["tc"];let c=1;const l=new r["Kc"];let h=!1;const d=new r["Jc"],p=new r["Jc"],u=new r["Jc"],m=new r["Jc"],g=new r["Jc"],f=new r["Jc"],E=new r["Jc"],y=new r["Jc"],v=new r["Jc"],b=[],M={},S=()=>2*Math.PI/60/60*this.autoRotateSpeed,w=()=>Math.pow(.95,this.zoomSpeed),T=e=>{a.theta-=e},x=e=>{a.phi-=e},R=function(){const e=new r["Kc"];return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),l.add(e)}}(),O=(()=>{const e=new r["Kc"];return(t,n)=>{!0===this.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(this.object.up,e)),e.multiplyScalar(t),l.add(e)}})(),C=(()=>{const e=new r["Kc"];return(t,n)=>{const s=this.domElement;if(this.object instanceof r["Lb"]){const r=this.object.position;e.copy(r).sub(this.target);let i=e.length();i*=Math.tan(this.object.fov/2*Math.PI/180),R(2*t*i/s.clientHeight,this.object.matrix),O(2*n*i/s.clientHeight,this.object.matrix)}else this.object instanceof r["Ib"]?(R(t*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),O(n*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),L=e=>{this.object instanceof r["Lb"]?c/=e:this.object instanceof r["Ib"]?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),this.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},I=e=>{this.object instanceof r["Lb"]?c*=e:this.object instanceof r["Ib"]?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),this.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function D(e){d.set(e.clientX,e.clientY)}function P(e){E.set(e.clientX,e.clientY)}function j(e){m.set(e.clientX,e.clientY)}const N=e=>{p.set(e.clientX,e.clientY),u.subVectors(p,d).multiplyScalar(this.rotateSpeed);const t=this.domElement;T(2*Math.PI*u.x/t.clientHeight),x(2*Math.PI*u.y/t.clientHeight),d.copy(p),this.update()},U=e=>{y.set(e.clientX,e.clientY),v.subVectors(y,E),v.y>0?L(w()):v.y<0&&I(w()),E.copy(y),this.update()},G=e=>{g.set(e.clientX,e.clientY),f.subVectors(g,m).multiplyScalar(this.panSpeed),C(f.x,f.y),m.copy(g),this.update()},B=e=>{e.deltaY<0?I(w()):e.deltaY>0&&L(w()),this.update()},H=e=>{let t=!1;switch(e.code){case this.keys.UP:C(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:C(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:C(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:C(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())};function z(){if(1===b.length)d.set(b[0].pageX,b[0].pageY);else{const e=.5*(b[0].pageX+b[1].pageX),t=.5*(b[0].pageY+b[1].pageY);d.set(e,t)}}function k(){if(1===b.length)m.set(b[0].pageX,b[0].pageY);else{const e=.5*(b[0].pageX+b[1].pageX),t=.5*(b[0].pageY+b[1].pageY);m.set(e,t)}}function F(){const e=b[0].pageX-b[1].pageX,t=b[0].pageY-b[1].pageY,n=Math.sqrt(e*e+t*t);E.set(0,n)}const Y=()=>{this.enableZoom&&F(),this.enablePan&&k()},_=()=>{this.enableZoom&&F(),this.enableRotate&&z()},W=e=>{if(1==b.length)p.set(e.pageX,e.pageY);else{const t=oe(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}u.subVectors(p,d).multiplyScalar(this.rotateSpeed);const t=this.domElement;T(2*Math.PI*u.x/t.clientHeight),x(2*Math.PI*u.y/t.clientHeight),d.copy(p)},V=e=>{if(1===b.length)g.set(e.pageX,e.pageY);else{const t=oe(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);g.set(n,r)}f.subVectors(g,m).multiplyScalar(this.panSpeed),C(f.x,f.y),m.copy(g)},K=e=>{const t=oe(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);y.set(0,s),v.set(0,Math.pow(y.y/E.y,this.zoomSpeed)),L(v.y),E.copy(y)},Q=e=>{this.enableZoom&&K(e),this.enablePan&&V(e)},$=e=>{this.enableZoom&&K(e),this.enableRotate&&W(e)};this.onPointerDown=e=>{!1!==this.enabled&&(0===b.length&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),re(e),"touch"===e.pointerType?ee(e):X(e))};let J=!1;this.onPointerMove=e=>{!1!==this.enabled&&(J||(this.domElement.setPointerCapture(e.pointerId),J=!0),"touch"===e.pointerType?te(e):Z(e))},this.onPointerUp=e=>{!1!==this.enabled&&(J=!1,"touch"===e.pointerType?ne():q(e),se(e),0===b.length&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=e=>{se(e)};const X=e=>{let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case r["lb"].DOLLY:if(!1===this.enableZoom)return;P(e),s=n.DOLLY;break;case r["lb"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;j(e),s=n.PAN}else{if(!1===this.enableRotate)return;D(e),s=n.ROTATE}break;case r["lb"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;D(e),s=n.ROTATE}else{if(!1===this.enablePan)return;j(e),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&this.dispatchEvent({type:"start"})},Z=e=>{if(!1!==this.enabled)switch(s){case n.ROTATE:if(!1===this.enableRotate)return;N(e);break;case n.DOLLY:if(!1===this.enableZoom)return;U(e);break;case n.PAN:if(!1===this.enablePan)return;G(e);break}},q=e=>{this.dispatchEvent({type:"end"}),s=n.NONE};this.onMouseWheel=e=>{!1!==this.enabled&&!1!==this.enableZoom&&s===n.NONE&&(e.preventDefault(),this.dispatchEvent({type:"start"}),B(e),this.dispatchEvent({type:"end"}))},this.onKeyDown=e=>{!1!==this.enabled&&!1!==this.enablePan&&H(e)};const ee=e=>{switch(ie(e),b.length){case 1:switch(this.touches.ONE){case r["yc"].ROTATE:if(!1===this.enableRotate)return;z(),s=n.TOUCH_ROTATE;break;case r["yc"].PAN:if(!1===this.enablePan)return;k(),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(this.touches.TWO){case r["yc"].DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;Y(),s=n.TOUCH_DOLLY_PAN;break;case r["yc"].DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;_(),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&this.dispatchEvent({type:"start"})},te=e=>{switch(ie(e),s){case n.TOUCH_ROTATE:if(!1===this.enableRotate)return;W(e),this.update();break;case n.TOUCH_PAN:if(!1===this.enablePan)return;V(e),this.update();break;case n.TOUCH_DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;Q(e),this.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;$(e),this.update();break;default:s=n.NONE}},ne=e=>{this.dispatchEvent({type:"end"}),s=n.NONE};function re(e){b.push(e)}this.onContextMenu=e=>{!1!==this.enabled&&e.preventDefault()};const se=e=>{delete M[e.pointerId];for(let t=0;t<b.length;t++)if(b[t].pointerId==e.pointerId)return void b.splice(t,1)};function ie(e){let t=M[e.pointerId];void 0===t&&(t=new r["Jc"],M[e.pointerId]=t),t.set(e.pageX,e.pageY)}function oe(e){const t=e.pointerId===b[0].pointerId?b[1]:b[0];return M[t.pointerId]}this.spherical=o,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),s=n.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),null!==this._domElementKeyEvents&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}var N=(e=>(e["DEFAULT"]="default",e["TOP"]="top",e["BOTTOM"]="bottom",e["LEFT"]="left",e["RIGHT"]="right",e["FRONT"]="front",e["BACK"]="back",e))(N||{});const U=function(e={}){if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!e.viewpoint&&(e.viewpoint="default"),!e.perspective&&(e.perspective={}),!e.perspective.position&&(e.perspective.position={x:60,y:60,z:60}),!e.perspective.lookAt&&(e.perspective.lookAt={x:0,y:0,z:0}),!e.perspective.up&&(e.perspective.up={x:0,y:1,z:0}),!e.orthograpbic&&(e.orthograpbic={}),!e.orthograpbic.up&&(e.orthograpbic.up={x:0,y:1,z:0});const t=new r["Lb"];t.position.set(e.perspective.position.x,e.perspective.position.y,e.perspective.position.z),t.lookAt(e.perspective.lookAt.x,e.perspective.lookAt.y,e.perspective.lookAt.z),t.up.set(e.perspective.up.x,e.perspective.up.y,e.perspective.up.z);const n=e.orthograpbic.distance||1e4,s=new r["Ib"](-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,n);return s.up.set(e.perspective.up.x,e.perspective.up.y,e.perspective.up.z),this.setViewpoint=function(e){return this.dispatchEvent({type:"setViewpoint",viewpoint:e}),this},this.addEventListener("setSize",e=>{const r=e.width,i=e.height,o=r/i;t.aspect=o,t.updateProjectionMatrix(),s.left=-n*o,s.right=n*o,s.top=n,s.bottom=-n,s.zoom=n/i*5,s.updateProjectionMatrix()}),e.orthograpbic.allowRotate,this.addEventListener("setViewpoint",e=>{const r=e.viewpoint;"default"!==r?("top"===r?s.position.set(0,n/2,0):"bottom"===r?s.position.set(0,-n/2,0):"right"===r?s.position.set(n/2,0,0):"left"===r?s.position.set(-n/2,0,0):"front"===r?s.position.set(0,0,n/2):"back"===r&&s.position.set(0,0,-n/2),this.setCamera(s)):this.setCamera(t)}),this.completeSet.add(()=>{"default"===e.viewpoint?this.setCamera(t):this.setCamera(s),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(t,s)}),!0},G=function(e){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new j(this.camera,this.dom),this.addEventListener("setCamera",e=>{e.options.orbitControls&&this.orbitControls.setCamera(e.camera)}),this.addEventListener("setDom",e=>{this.orbitControls.setDom(e.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const t=e.viewpoint;this.orbitControls.target.set(0,0,0),t===N.DEFAULT?this.orbitControls.enableRotate=!0:(t===N.TOP||t===N.BOTTOM||t===N.RIGHT||t===N.LEFT||t===N.FRONT||t===N.BACK)&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class B{constructor(e){A(this,"REVISION"),A(this,"dom"),A(this,"addPanel"),A(this,"showPanel"),A(this,"begin"),A(this,"end"),A(this,"update"),A(this,"domElement"),A(this,"setMode");const t=Object(s["a"])();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const n=this.domElement;n.style.position="absolute",n.style.top="0",n.style.left="35px",e&&(n.style.top=e.top+"px",n.style.left=e.left+"px",n.style.right=e.right+"px",n.style.bottom=e.bottom+"px")}}const H=function(e){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const t=new B(e);this.stats=t;const n=()=>{this.stats.update()};return this.setStats=function(e){if(e)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",n);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",n)}catch(t){}return this},!0},z=function(e={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let t,n;if(e.WebGLMultisampleRenderTarget||e.MSAA){const n=this.webGLRenderer,s=n.getPixelRatio(),o=n.getDrawingBufferSize(new r["Jc"]);t=Number(window.__THREE__)>137?new i["a"](n,new r["Nc"](o.width*s,o.height*s,{format:e.format||r["Vb"],samples:e.samples||4})):new i["a"](n,new r["Mc"](o.width*s,o.height*s,{format:e.format||r["Vb"]}))}else t=new i["a"](this.webGLRenderer);return this.effectComposer=t,this.scene&&this.camera&&(n=new o["a"](this.scene,this.camera),t.addPass(n)),this.addEventListener("setCamera",e=>{if(!n&&this.scene)return n=new o["a"](this.scene,e.camera),void t.addPass(n);n&&(n.camera=e.camera)}),this.addEventListener("setScene",e=>{if(!n&&this.camera)return n=new o["a"](e.scene,this.camera),void t.addPass(n);n&&(n.scene=e.scene)}),this.addEventListener("setSize",e=>{t.setSize(e.width,e.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",e=>{this.effectComposer.render(e.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class k extends I{constructor(e){super(),A(this,"dom"),A(this,"mouse"),A(this,"canMouseMove"),A(this,"mouseEventTimer"),A(this,"throttleTime"),A(this,"pointerDownHandler"),A(this,"pointerMoveHandler"),A(this,"pointerUpHandler"),A(this,"mouseDownHandler"),A(this,"mouseUpHandler"),A(this,"clickHandler"),A(this,"dblclickHandler"),A(this,"contextmenuHandler"),this.dom=e.dom,this.mouse=new r["Jc"],this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=e=>{const t={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const n in e)t[n]=e[n];return t},n=e=>{this.dispatchEvent(t(e))};this.pointerMoveHandler=e=>{this.canMouseMove&&(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const n=this.mouse,r=this.dom,s=r.getBoundingClientRect();n.x=(e.clientX-s.left)/r.offsetWidth*2-1,n.y=-(e.clientY-s.top)/r.offsetHeight*2+1,this.canMouseMove=!0,this.dispatchEvent(t(e))},this.throttleTime))},this.mouseDownHandler=n,this.mouseUpHandler=n,this.pointerDownHandler=n,this.pointerUpHandler=n,this.clickHandler=n,this.dblclickHandler=n,this.contextmenuHandler=n}setDom(e){if(this.dom){const e=this.dom;e.removeEventListener("mousedown",this.mouseDownHandler),e.removeEventListener("mouseup",this.mouseUpHandler),e.removeEventListener("pointerdown",this.pointerDownHandler),e.removeEventListener("pointermove",this.pointerMoveHandler),e.removeEventListener("pointerup",this.pointerUpHandler),e.removeEventListener("click",this.clickHandler),e.removeEventListener("dblclick",this.dblclickHandler),e.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const F=function(e){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const t=new k(Object.assign(e||{},{dom:this.dom}));return this.addEventListener("setDom",e=>{t.setDom(e.dom)}),this.pointerManager=t,!0};var Y=(e=>(e["POINTERDOWN"]="pointerdown",e["POINTERUP"]="pointerup",e["POINTERMOVE"]="pointermove",e["POINTERENTER"]="pointerenter",e["POINTERLEAVE"]="pointerleave",e["CLICK"]="click",e["DBLCLICK"]="dblclick",e["CONTEXTMENU"]="contextmenu",e))(Y||{});class _ extends I{constructor(e){super(),A(this,"raycaster"),A(this,"scene"),A(this,"camera"),A(this,"filter",new Set),A(this,"recursive",!1),A(this,"penetrate",!1),A(this,"propagation",!1),A(this,"delegation",!1),this.raycaster=new r["gc"],this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const t=this.filter,n=this.scene.children.filter(e=>!t.has(e));return this.raycaster.intersectObjects(n,this.recursive)}use(e){const t=function(e,t){return Object.assign({},e,t)},n=(e,n)=>{const r=this.intersectObject(e.mouse);if(r.length)if(this.penetrate)for(const s of r)s.object.dispatchEvent(t(e,{type:n,intersection:s}));else{const s=r[0];s.object.dispatchEvent(t(e,{type:n,intersection:s}))}this.dispatchEvent(t(e,{type:n,intersections:r}))},r=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const o of r)e.addEventListener(o,e=>{n(e,o)});const s=new Map;let i=null;return e.addEventListener("pointermove",e=>{const n=this.intersectObject(e.mouse);if(this.penetrate){if(!n.length)return s.forEach(n=>{n.object.dispatchEvent(t(e,{type:"pointerleave",intersection:n})),n.object.dispatchEvent(t(e,{type:"mouseleave",intersection:n}))}),void s.clear();for(const r of n)s.has(r.object)?(r.object.dispatchEvent(t(e,{type:"pointermove",intersection:r})),r.object.dispatchEvent(t(e,{type:"mousemove",intersection:r})),s.delete(r.object)):(r.object.dispatchEvent(t(e,{type:"pointerenter",intersection:r})),r.object.dispatchEvent(t(e,{type:"mouseenter",intersection:r})));for(const n of s.values())n.object.dispatchEvent(t(e,{type:"pointerleave",intersection:n})),n.object.dispatchEvent(t(e,{type:"mouseleave",intersection:n}));s.clear();for(const e of n)s.set(e.object,e)}else{if(!n.length)return void(i&&(i.object.dispatchEvent(t(e,{type:"pointerleave",intersection:i})),i.object.dispatchEvent(t(e,{type:"mouseleave",intersection:i})),i=null));const r=n[0];if(!i)return r.object.dispatchEvent(t(e,{type:"pointerenter",intersection:r})),r.object.dispatchEvent(t(e,{type:"mouseenter",intersection:r})),void(i=r);if(r.object!==i.object)return i.object.dispatchEvent(t(e,{type:"pointerleave",intersection:r})),i.object.dispatchEvent(t(e,{type:"mouseleave",intersection:r})),r.object.dispatchEvent(t(e,{type:"pointerenter",intersection:r})),r.object.dispatchEvent(t(e,{type:"mouseenter",intersection:r})),void(i=r);r.object===i.object&&(r.object.dispatchEvent(t(e,{type:"pointermove",intersection:r})),r.object.dispatchEvent(t(e,{type:"mousemove",intersection:r})))}this.dispatchEvent(t(e,{type:"pointermove",intersections:n})),this.dispatchEvent(t(e,{type:"mousemove",intersections:n}))}),this}}const W=function(e){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const t=new _(Object.assign({scene:this.scene,camera:this.camera},e));return t.use(this.pointerManager),this.eventManager=t,this.addEventListener("setCamera",e=>{this.eventManager.setCamera(e.camera)}),this.addEventListener("setScene",e=>{this.eventManager.setScene(e.scene)}),!0};var V=(e=>(e["OBJECTCHANGED"]="objectChanged",e))(V||{});class K extends a["a"]{constructor(e,t){!e&&(e=new r["Lb"]),!t&&(t=document.body),super(e,t),A(this,"target"),A(this,"transObjectSet"),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=e=>{var t;this.enabled&&(null==(t=this.object)?void 0:t.parent)&&(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new r["Eb"],this.transObjectSet=new Set;let n="";const s=this.target,i=this.transObjectSet,o={x:0,y:0,z:0},a=new WeakMap;this.addEventListener("mouseDown",e=>{n=e.target.mode,"translate"===n&&(n="position"),"rotate"===n&&(n="rotation"),o.x=s[n].x,o.y=s[n].y,o.z=s[n].z,i.forEach(e=>{a.set(e,e.matrixAutoUpdate),e.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",e=>{const t=s[n].x-o.x,r=s[n].y-o.y,a=s[n].z-o.z;o.x=s[n].x,o.y=s[n].y,o.z=s[n].z,i.forEach(e=>{e[n].x+=t,e[n].y+=r,e[n].z+=a,e.updateMatrix(),e.updateMatrixWorld()}),this.dispatchEvent({type:"objectChanged",transObjectSet:i,mode:n,target:s})}),this.addEventListener("mouseUp",e=>{i.forEach(e=>{e.matrixAutoUpdate=a.get(e),a.delete(e)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(1===e.length){const n=e[0];return n.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(n),this}const n=[],r=[],s=[];return e.forEach(e=>{n.push(e.matrixWorld.elements[12]),r.push(e.matrixWorld.elements[13]),s.push(e.matrixWorld.elements[14])}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...n)-Math.min(...n))/2+Math.min(...n),t.position.y=(Math.max(...r)-Math.min(...r))/2+Math.min(...r),t.position.z=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(e=>{this.transObjectSet.add(e)}),this}}const Q=function(e){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const t=new K(this.camera,this.dom);return t.detach(),this.transformControls=t,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(e){return e?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",e=>{e.options.transformControls&&t.setCamera(e.camera)}),this.addEventListener("setDom",e=>{t.setDom(e.dom)}),this.addEventListener("setScene",e=>{const t=e.scene;t.add(this.transformControls.target),t.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",e=>{t.setAttach(...e.objects)}):this.eventManager.addEventListener("click",e=>{if(this.transing)this.transing=!1;else if(0===e.button){const n=e.intersections.map(e=>e.object),r=n[0]||null;r?t.setAttach(r):t.detach()}}),this.eventManager.addFilterObject(t),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const e=e=>{const t=this.compilerManager.getObjectSymbol(e);return t?this.dataSupportManager.getConfigBySymbol(t):null};let n,r=null;t.addEventListener(V.OBJECTCHANGED,t=>{const s=t;s.transObjectSet.forEach(t=>{r=e(t),n=s.mode,r&&(r[n].x=t[n].x,r[n].y=t[n].y,r[n].z=t[n].z)})})}}),!0},$=function(e={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new r["Oc"](e);const t=this.webGLRenderer.domElement;return t.style.position="absolute",t.style.top="0",t.style.left="0",t.classList.add("vis-webgl"),this.getScreenshot=async function(e={}){const t={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!e.width&&(e.width=this.dom.offsetWidth),!e.height&&(e.height=this.dom.offsetHeight),!e.mine&&(e.mine="image/png");let n=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),n=!0);let r="";const s=this.webGLRenderer.getContext(),i=s.getParameter(s.MAX_RENDERBUFFER_SIZE),o=i/4;if(e.width>o||e.height>o){const n=[],s=Math.ceil(e.width/o),i=Math.ceil(e.height/o),a=e.width/s,c=e.height/i,l=document.createElement("canvas");l.setAttribute("width",e.width.toString()),l.setAttribute("height",e.height.toString());const h=l.getContext("2d");if(!h)return console.warn("can not support canvas 2d;"),r;this.setSize(a,c);for(let e=0;e<s;e+=1)for(let t=0;t<i;t+=1)n.push({x:a*e,y:c*t});const d=[];n.forEach(t=>{this.camera.setViewOffset(e.width,e.height,t.x,t.y,a,c),this.renderManager.render();const n=this.webGLRenderer.domElement.toDataURL(e.mine);d.push(new Promise((e,r)=>{const s=new Image;s.src=n,s.onload=()=>{h.drawImage(s,t.x,t.y,a,c),e(null)}}))}),this.setSize(t.width,t.height),await Promise.all(d).catch(e=>{console.warn(e)}),r=l.toDataURL(e.mine),this.camera.clearViewOffset()}else this.setSize(e.width,e.height),this.renderManager.render(),r=this.webGLRenderer.domElement.toDataURL(e.mine),this.setSize(t.width,t.height);return n&&this.renderManager.play(),r},this.addEventListener("setDom",e=>{e.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",e=>{this.webGLRenderer.setSize(e.width,e.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",e=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},J=class extends r["jb"]{constructor(e){super(e)}load(e,t,n,s){void 0!==this.path&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const i=r["l"].get(e);if(void 0!==i)return setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;const o=document.createElement("video");return o.preload=J.preload,o.autoplay=J.autoplay,o.loop=J.loop,o.muted=J.muted,o.src=e,o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="-1",document.body.appendChild(o),o.oncanplay=()=>{r["l"].add(e,o),this.manager.itemEnd(e),t&&t(o)},o.onerror=t=>{this.manager.itemEnd(e),s&&s(t)},o}};let X=J;A(X,"autoplay",!0),A(X,"preload","auto"),A(X,"muted",!0),A(X,"loop",!0);class Z extends I{constructor(e){super(),A(this,"resourceMap"),A(this,"loaderMap"),A(this,"urlList",[]),A(this,"loadTotal"),A(this,"loadSuccess"),A(this,"loadError"),A(this,"isError"),A(this,"isLoading"),A(this,"isLoaded"),A(this,"loadDetailMap"),A(this,"path",""),this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new r["T"],n=new X,s=new d["a"];s.setDRACOLoader(new p["a"]),s.setKTX2Loader(new u["a"]),s.setMeshoptDecoder(m["a"]),this.loaderMap={jpg:t,png:t,jpeg:t,obj:new c["a"],mtl:new l["a"],mp4:n,webm:n,ogg:n,hdr:new h["a"],gltf:s,glb:s},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:"loaded",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach(t=>{t.setRequestHeader(e)}),this}setResponseType(e){return Object.values(this.loaderMap).forEach(t=>{t.setResponseType&&t.setResponseType(e)}),this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var t;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:"beforeLoad",urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const n=this.resourceMap,r=this.loaderMap,s=this.loadDetailMap;for(const i of e){let e,o;"string"===typeof i?(e=i,o=(null==(t=e.split(".").pop())?void 0:t.toLocaleLowerCase())||""):(e=i.url,o=i.ext.toLocaleLowerCase(),o.startsWith(".")&&(o=o.slice(1)));const a={url:e,progress:0,error:!1,message:e};if(s[e]=a,n.has(e)){a.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!o){a.message=`url: ${e} 地址有误，无法获取文件格式。`,console.warn(a.message),a.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const c=r[o];if(!c){a.message=`url: ${e} 不支持此文件格式加载。`,console.warn(a.message),a.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const l=e.replace(/\\/g,"/").split("/"),h=l.pop(),d=this.path+l.join("/")+"/";c.setPath(d).loadAsync(h,e=>{a.progress=Number((e.loaded/e.total).toFixed(2)),this.dispatchEvent({type:"detailLoading",detail:a})}).then(t=>{a.progress=1,this.loadSuccess+=1,this.resourceMap.set(e,t),this.urlList.push(i),this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(e=>{a.error=!0,a.message=JSON.stringify(e),this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){return JSON.stringify(this.urlList)}exportConfig(){return JSON.parse(JSON.stringify(this.urlList))}dispose(){return this.resourceMap.clear(),this}}const q=function(e){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const t=new Z(e);return this.loaderManager=t,this.loadResources=(e,t)=>{if(this.resourceManager){const e=n=>{t(void 0,n),this.resourceManager.removeEventListener("mapped",e)};try{this.resourceManager.addEventListener("mapped",e)}catch(n){t(n)}}else{const e=n=>{t(void 0,n),this.loaderManager.removeEventListener("loaded",e)};try{this.loaderManager.addEventListener("loaded",e)}catch(n){t(n)}}return this.loaderManager.load(e),this},this.loadResourcesAsync=e=>new Promise((t,n)=>{if(this.resourceManager){const e=n=>{t(n),this.resourceManager.removeEventListener("mapped",e)};try{this.resourceManager.addEventListener("mapped",e)}catch(r){n(r)}}else{const e=n=>{t(n),this.loaderManager.removeEventListener("loaded",e)};try{this.loaderManager.addEventListener("loaded",e)}catch(r){n(r)}}this.loaderManager.load(e)}),!0};var ee=(e=>(e["BOXGEOMETRY"]="BoxGeometry",e["SPHEREGEOMETRY"]="SphereGeometry",e["LOADGEOMETRY"]="LoadGeometry",e["PLANEGEOMETRY"]="PlaneGeometry",e["CIRCLEGEOMETRY"]="CircleGeometry",e["CONEGEOMETRY"]="ConeGeometry",e["CYLINDERGEOMETRY"]="CylinderGeometry",e["DODECAHEDRONGEOMETRY"]="DodecahedronGeometry",e["TORUSGEOMETRY"]="TorusGeometry",e["RINGGEOMETRY"]="RingGeometry",e["EDGESGEOMETRY"]="EdgesGeometry",e["LINECURVEGEOMETRY"]="LineCurveGeometry",e["SPLINECURVEGEOMETRY"]="SplineCurveGeometry",e["CUBICBEZIERCURVEGEOMETRY"]="CubicBezierCurveGeometry",e["QUADRATICBEZIERCURVEGEOMETRY"]="QuadraticBezierCurveGeometry",e["CUSTOMGEOMETRY"]="CustomGeometry",e["LINETUBEGEOMETRY"]="LineTubeGeometry",e["SPLINETUBEGEOMETRY"]="SplineTubeGeometry",e["LINESHAPEGEOMETRY"]="LineShapeGeometry",e["OBJECT3D"]="Object3D",e["MESH"]="Mesh",e["LINE"]="Line",e["POINTS"]="Points",e["SPRITE"]="Sprite",e["GROUP"]="Group",e["CSS3DOBJECT"]="CSS3DObject",e["CSS3DSPRITE"]="CSS3DSprite",e["CSS3DPLANE"]="CSS3DPlane",e["CSS2DPLANE"]="CSS2DPlane",e["IMAGETEXTURE"]="ImageTexture",e["CUBETEXTURE"]="CubeTexture",e["CANVASTEXTURE"]="CanvasTexture",e["VIDEOTEXTURE"]="VideoTexture",e["LOADTEXTURE"]="LoadTexture",e["MESHBASICMATERIAL"]="MeshBasicMaterial",e["MESHSTANDARDMATERIAL"]="MeshStandardMaterial",e["MESHPHONGMATERIAL"]="MeshPhongMaterial",e["SPRITEMATERIAL"]="SpriteMaterial",e["LINEBASICMATERIAL"]="LineBasicMaterial",e["POINTSMATERIAL"]="PointsMaterial",e["SHADERMATERIAL"]="ShaderMaterial",e["MESHPHYSICALMATERIAL"]="MeshPhysicalMaterial",e["AMBIENTLIGHT"]="AmbientLight",e["SPOTLIGHT"]="SpotLight",e["POINTLIGHT"]="PointLight",e["DIRECTIONALLIGHT"]="DirectionalLight",e["HEMISPHERELIGHT"]="HemisphereLight",e["PERSPECTIVECAMERA"]="PerspectiveCamera",e["ORTHOGRAPHICCAMERA"]="OrthographicCamera",e["WEBGLRENDERER"]="WebGLRenderer",e["CSS3DRENDERER"]="CSS3DRenderer",e["SCENE"]="Scene",e["TRNASFORMCONTROLS"]="TransformControls",e["ORBITCONTROLS"]="OrbitControls",e["SMAAPASS"]="SMAAPass",e["UNREALBLOOMPASS"]="UnrealBloomPass",e["SELECTIVEBLOOMPASS"]="SelectiveBloomPass",e["SCRIPTANIMATION"]="ScriptAnimation",e["KEYFRAMEANIMATION"]="KeyframeAnimation",e))(ee||{}),te=(e=>(e["OBJECT3D"]="object3D",e["CAMERA"]="camera",e["LIGHT"]="light",e["GEOMETRY"]="geometry",e["TEXTURE"]="texture",e["MATERIAL"]="material",e["RENDERER"]="renderer",e["SCENE"]="scene",e["SPRITE"]="sprite",e["CONTROLS"]="controls",e["LINE"]="line",e["MESH"]="mesh",e["POINTS"]="points",e["GROUP"]="group",e["CSS3D"]="css3D",e["CSS2D"]="css2D",e["PASS"]="pass",e["ANIMATION"]="animation",e))(te||{});const ne={["camera"]:!0,["light"]:!0,["scene"]:!0,["sprite"]:!0,["line"]:!0,["mesh"]:!0,["points"]:!0,["group"]:!0,["css3D"]:!0,["css2D"]:!0,["object3D"]:!0},re=(ee.IMAGETEXTURE,te.TEXTURE,ee.CUBETEXTURE,te.TEXTURE,ee.CANVASTEXTURE,te.TEXTURE,ee.VIDEOTEXTURE,te.TEXTURE,ee.MESHBASICMATERIAL,te.MATERIAL,ee.MESHSTANDARDMATERIAL,te.MATERIAL,ee.MESHPHONGMATERIAL,te.MATERIAL,ee.SPRITEMATERIAL,te.MATERIAL,ee.LINEBASICMATERIAL,te.MATERIAL,ee.POINTSMATERIAL,te.MATERIAL,ee.SHADERMATERIAL,te.MATERIAL,ee.AMBIENTLIGHT,te.LIGHT,ee.SPOTLIGHT,te.LIGHT,ee.POINTLIGHT,te.LIGHT,ee.DIRECTIONALLIGHT,te.LIGHT,ee.BOXGEOMETRY,te.GEOMETRY,ee.SPHEREGEOMETRY,te.GEOMETRY,ee.LOADGEOMETRY,te.GEOMETRY,ee.CUSTOMGEOMETRY,te.GEOMETRY,ee.PLANEGEOMETRY,te.GEOMETRY,ee.CIRCLEGEOMETRY,te.GEOMETRY,ee.CONEGEOMETRY,te.GEOMETRY,ee.CIRCLEGEOMETRY,te.GEOMETRY,ee.EDGESGEOMETRY,te.GEOMETRY,ee.CYLINDERGEOMETRY,te.GEOMETRY,ee.LINECURVEGEOMETRY,te.GEOMETRY,ee.SPLINECURVEGEOMETRY,te.GEOMETRY,ee.CUBICBEZIERCURVEGEOMETRY,te.GEOMETRY,ee.QUADRATICBEZIERCURVEGEOMETRY,te.GEOMETRY,ee.LINETUBEGEOMETRY,te.GEOMETRY,ee.SPLINETUBEGEOMETRY,te.GEOMETRY,ee.TORUSGEOMETRY,te.GEOMETRY,ee.RINGGEOMETRY,te.GEOMETRY,ee.LINESHAPEGEOMETRY,te.GEOMETRY,ee.SPRITE,te.SPRITE,ee.LINE,te.LINE,ee.MESH,te.MESH,ee.POINTS,te.POINTS,ee.GROUP,te.GROUP,ee.CSS3DOBJECT,te.CSS3D,ee.CSS3DSPRITE,te.CSS3D,ee.CSS3DPLANE,te.CSS3D,ee.PERSPECTIVECAMERA,te.CAMERA,ee.ORTHOGRAPHICCAMERA,te.CAMERA,ee.WEBGLRENDERER,te.RENDERER,ee.SCENE,te.SCENE,ee.TRNASFORMCONTROLS,te.CONTROLS,ee.ORBITCONTROLS,te.CONTROLS,ee.SMAAPASS,te.PASS,ee.UNREALBLOOMPASS,te.PASS,ee.SCRIPTANIMATION,te.ANIMATION,ee.KEYFRAMEANIMATION,te.ANIMATION,e=>{const t=t=>e.toLocaleLowerCase().includes(t.toLocaleLowerCase());for(const n of Object.values(te))if(t(n))return n;return null}),se=e=>ne[e],ie=e=>{const t=re(e);return!!t&&se(t)},oe=()=>({vid:"",name:"",type:ee.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),ae=function(){return Object.assign(oe(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},ce=function(){return Object.assign(oe(),{type:ee.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},le=function(){return Object.assign(ae(),{type:ee.POINTLIGHT,distance:30,decay:.01})},he=function(){return Object.assign(ae(),{type:ee.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},de=function(){return Object.assign(ae(),{type:ee.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},pe=function(){return Object.assign(ae(),{type:ee.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},ue=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},me=function(){return Object.assign(ue(),{type:ee.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},ge=function(){return Object.assign(ue(),{type:ee.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI})},fe=function(){return Object.assign(ue(),{type:ee.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},Ee=function(){return Object.assign(ue(),{type:ee.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:2*Math.PI})},ye=function(){return Object.assign(ue(),{type:ee.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI})},ve=function(){return Object.assign(ue(),{type:ee.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:2*Math.PI})},be=function(){return Object.assign(ue(),{type:ee.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:2*Math.PI})},Me=function(){return Object.assign(ue(),{type:ee.LOADGEOMETRY,url:""})},Se=function(){return Object.assign(ue(),{type:ee.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},we=function(){return Object.assign(ue(),{type:ee.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI})},Te=function(){return Object.assign(ue(),{type:"",radius:3,detail:0})},xe=function(){return Object.assign(ue(),{type:ee.LOADGEOMETRY,url:"",thresholdAngle:1})},Re=function(){return Object.assign(ue(),{path:[],divisions:36,space:!0})},Oe=function(){return Object.assign(Re(),{type:ee.LINECURVEGEOMETRY})},Ce=function(){return Object.assign(Re(),{type:ee.SPLINECURVEGEOMETRY})},Le=function(){return Object.assign(Re(),{type:ee.CUBICBEZIERCURVEGEOMETRY})},Ae=function(){return Object.assign(Re(),{type:ee.QUADRATICBEZIERCURVEGEOMETRY})},Ie=function(){return Object.assign(ue(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},De=function(){return Object.assign(Ie(),{type:ee.LINETUBEGEOMETRY})},Pe=function(){return Object.assign(Ie(),{type:ee.SPLINETUBEGEOMETRY})},je=function(){return Object.assign(ue(),{path:[],curveSegments:12})},Ne=function(){return Object.assign(je(),{type:ee.LINESHAPEGEOMETRY})},Ue=function(){return{vid:"",type:"Texture",name:"",mapping:r["Gc"],wrapS:r["r"],wrapT:r["r"],magFilter:r["gb"],minFilter:r["hb"],anisotropy:1,format:r["Vb"],flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:r["fb"],needsUpdate:!1}},Ge=function(){return Object.assign(Ue(),{type:ee.IMAGETEXTURE,url:""})},Be=function(){return Object.assign(Ue(),{type:ee.VIDEOTEXTURE,url:"",minFilter:r["gb"]})},He=function(){return Object.assign(Ue(),{type:ee.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:r["w"],flipY:!1})},ze=function(){return Object.assign(Ue(),{type:ee.CANVASTEXTURE,url:"",needsUpdate:!1})},ke=function(){return Object.assign(Ue(),{type:ee.LOADTEXTURE,url:""})},Fe=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:r["O"],toneMapped:!0,transparent:!1,visible:!0,blendDst:r["Hb"],blendDstAlpha:null,blendEquation:r["a"],blendEquationAlpha:null,blending:r["Cb"],blendSrc:r["xc"],blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},Ye=function(){return Object.assign(Fe(),{type:ee.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:r["xb"],aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},_e=function(){return Object.assign(Fe(),{type:ee.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:r["zc"],refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},We=function(){return Object.assign(_e(),{type:ee.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},Ve=function(){return Object.assign(Fe(),{type:ee.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:r["zc"],refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:r["xb"],normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},Ke=function(){return Object.assign(Fe(),{type:ee.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},Qe=function(){return Object.assign(Fe(),{type:ee.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},$e=function(){return Object.assign(Fe(),{type:ee.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},Je=function(){return Object.assign(Fe(),{type:ee.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},Xe=function(){return Object.assign(oe(),{type:ee.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},Ze=function(){return Object.assign(oe(),{type:ee.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})};ee.WEBGLRENDERER,ee.CSS3DRENDERER,ee.SCENE;const qe=function(e){return"DEFUALT-"+e},et=function(){return{vid:"",type:"Renderer",size:null}},tt=function(){return Object.assign(et(),{vid:qe(ee.WEBGLRENDERER),type:ee.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:r["fb"],physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:r["Jb"]},toneMapping:r["Bb"],toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},nt=function(){return Object.assign(et(),{vid:qe(ee.CSS3DRENDERER),type:ee.CSS3DRENDERER})},rt=function(){return Object.assign(oe(),{vid:qe(ee.SCENE),type:ee.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},st=function(){return{vid:qe(ee.TRNASFORMCONTROLS),type:ee.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},it=function(){return{vid:qe(ee.ORBITCONTROLS),type:ee.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},ot=function(){return Object.assign(oe(),{material:"",geometry:""})},at=function(){return Object.assign(ot(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},ct=function(){return Object.assign(ot(),{type:ee.MESH,geometry:"",material:""})},lt=function(){return Object.assign(ot(),{type:ee.POINTS,geometry:"",material:""})},ht=function(){return Object.assign(ot(),{type:ee.LINE,geometry:"",material:""})},dt=function(){return Object.assign(oe(),{type:ee.GROUP,children:[]})},pt=function(){return{vid:"",type:"Pass"}},ut=function(){return Object.assign(pt(),{type:ee.SMAAPASS})},mt=function(){return Object.assign(pt(),{type:ee.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},gt=function(){return Object.assign(pt(),{type:ee.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},ft=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},Et=function(){return Object.assign(ft(),{type:ee.SCRIPTANIMATION,script:{name:""}})},yt=function(){return Object.assign(ft(),{type:ee.KEYFRAMEANIMATION,script:{name:""}})},vt=function(){return Object.assign(oe(),{type:ee.CSS3DOBJECT,element:"",width:50,height:50})},bt=function(){return Object.assign(vt(),{type:ee.CSS3DPLANE})},Mt=function(){return Object.assign(vt(),{type:ee.CSS3DSPRITE,rotation2D:0})},St=function(){return Object.assign(oe(),{type:ee.CSS3DOBJECT,element:"",width:50,height:50})},wt=function(){return Object.assign(St(),{type:ee.CSS2DPLANE})},Tt={[ee.IMAGETEXTURE]:Ge,[ee.CUBETEXTURE]:He,[ee.CANVASTEXTURE]:ze,[ee.VIDEOTEXTURE]:Be,[ee.LOADTEXTURE]:ke,[ee.MESHBASICMATERIAL]:Ye,[ee.MESHSTANDARDMATERIAL]:_e,[ee.MESHPHONGMATERIAL]:Ve,[ee.SPRITEMATERIAL]:Ke,[ee.LINEBASICMATERIAL]:Qe,[ee.POINTSMATERIAL]:$e,[ee.SHADERMATERIAL]:Je,[ee.MESHPHYSICALMATERIAL]:We,[ee.AMBIENTLIGHT]:ce,[ee.SPOTLIGHT]:he,[ee.POINTLIGHT]:le,[ee.DIRECTIONALLIGHT]:de,[ee.HEMISPHERELIGHT]:pe,[ee.BOXGEOMETRY]:me,[ee.SPHEREGEOMETRY]:ge,[ee.LOADGEOMETRY]:Me,[ee.CUSTOMGEOMETRY]:Se,[ee.PLANEGEOMETRY]:fe,[ee.CIRCLEGEOMETRY]:Ee,[ee.CONEGEOMETRY]:ye,[ee.CYLINDERGEOMETRY]:we,[ee.EDGESGEOMETRY]:xe,[ee.LINECURVEGEOMETRY]:Oe,[ee.SPLINECURVEGEOMETRY]:Ce,[ee.CUBICBEZIERCURVEGEOMETRY]:Le,[ee.QUADRATICBEZIERCURVEGEOMETRY]:Ae,[ee.DODECAHEDRONGEOMETRY]:Te,[ee.SPLINETUBEGEOMETRY]:Pe,[ee.LINETUBEGEOMETRY]:De,[ee.TORUSGEOMETRY]:ve,[ee.RINGGEOMETRY]:be,[ee.LINESHAPEGEOMETRY]:Ne,[ee.OBJECT3D]:oe,[ee.SPRITE]:at,[ee.LINE]:ht,[ee.MESH]:ct,[ee.POINTS]:lt,[ee.GROUP]:dt,[ee.CSS3DOBJECT]:vt,[ee.CSS3DSPRITE]:Mt,[ee.CSS3DPLANE]:bt,[ee.CSS2DPLANE]:wt,[ee.PERSPECTIVECAMERA]:Xe,[ee.ORTHOGRAPHICCAMERA]:Ze,[ee.WEBGLRENDERER]:tt,[ee.CSS3DRENDERER]:nt,[ee.SCENE]:rt,[ee.TRNASFORMCONTROLS]:st,[ee.ORBITCONTROLS]:it,[ee.SMAAPASS]:ut,[ee.UNREALBLOOMPASS]:mt,[ee.SELECTIVEBLOOMPASS]:gt,[ee.SCRIPTANIMATION]:Et,[ee.KEYFRAMEANIMATION]:yt};class xt{}class Rt extends xt{constructor(){super(...arguments),A(this,"selector",(e,t,n)=>t instanceof HTMLImageElement&&n.get(Rt)||null)}parse({url:e,resource:t,configMap:n,resourceMap:r}){const s=Tt[ee.IMAGETEXTURE]();s.url=e,r.set(e,t),n.set(e,s)}}class Ot extends xt{constructor(){super(...arguments),A(this,"selector",(e,t,n)=>t instanceof HTMLCanvasElement&&n.get(Ot)||null)}parse({url:e,resource:t,configMap:n,resourceMap:r}){const s=Tt[ee.CANVASTEXTURE]();s.url=e,r.set(e,t),n.set(e,s)}}class Ct extends xt{constructor(){super(...arguments),A(this,"selector",(e,t,n)=>t instanceof HTMLVideoElement&&n.get(Ct)||null)}parse({url:e,resource:t,configMap:n,resourceMap:r}){const s=Tt[ee.VIDEOTEXTURE]();s.url=e,r.set(e,t),n.set(e,s)}}function Lt(e,t){return e in t}function At(e,t){return Object.values(e).includes(t)}function It(e){return t=>{const n=(e,t)=>{for(const r in t)void 0!==e[r]?"object"!==typeof t[r]||null===t[r]||Array.isArray(t[r])?e[r]=t[r]:n(e[r],t[r]):console.warn(" config can not set key: "+r)};return t&&n(e,t),e}}function Dt(e,t,n,r){const s=(e,t,n)=>{for(const r in e)void 0!==t[r]&&(n&&n[r]||("object"!==typeof e[r]||null===typeof e[r]?t[r]=e[r]:n&&"object"===typeof n[r]&&null!==typeof n[r]?s(e[r],t[r],n[r]):s(e[r],t[r])))};s(e,t,n),r&&r()}const Pt=function(e){return"object"===typeof e&&null!==e},jt=function(e){return"object"===typeof e&&null!==e&&Array.isArray(e)},Nt=function(e,t){return e&&t?`${e}.${t}`:e||t},Ut=new WeakMap,Gt=function(e){Array.isArray(e)&&!Ut.has(e)&&Ut.set(e,e.concat([]))},Bt=function(e){return Ut.get(e)};Symbol.toStringTag;class Ht extends xt{constructor(){super(...arguments),A(this,"selector",(e,t,n)=>t.isObject3D&&n.get(Ht)||null)}parse(e){this.parseObject3D(e)}parseColor(e){return`rgb(${Math.round(255*e.r)}, ${Math.round(255*e.g)}, ${Math.round(255*e.b)})`}attributeEnhance(e){const t={};for(const n in e)n.startsWith("_")?t[n.slice(1)]=e[n]:t[n]=e[n];return t}parseTexture({url:e,resource:t,configMap:n,resourceMap:r}){r.set(e,t);const s=Tt[ee.LOADTEXTURE]();n.set(e,s),s.vid=Object(g["a"])(),s.url=e,Dt(t,s,{type:!0,vid:!0,url:!0})}parseMaterial({url:e,resource:t,configMap:n,resourceMap:r}){if(r.set(e,t),!Tt[t.type])return void console.warn("can not found support config in vis for this resource",t);const s=Tt[t.type]();n.set(e,s),s.vid=Object(g["a"])(),Dt(this.attributeEnhance(t),s,{type:!0,vid:!0});for(const i in t)if(t[i])if(t[i].isColor)s[i]=this.parseColor(t[i]);else if(i.toLocaleLowerCase().endsWith("map")&&t[i]){const o=`${e}.${i}`;this.parseTexture({url:o,resource:t[i],configMap:n,resourceMap:r}),s[i]=n.get(o).vid}}parseGeometry({url:e,resource:t,configMap:n,resourceMap:s}){s.set(e,t),t.computeBoundingBox();const i=t.boundingBox,o=i.getCenter(new r["Kc"]),a=Tt[ee.LOADGEOMETRY]();a.vid=Object(g["a"])(),a.url=e,a.position.x=o.x/(i.max.x-i.min.x)*2,a.position.y=o.y/(i.max.y-i.min.y)*2,a.position.z=o.z/(i.max.z-i.min.z)*2,n.set(e,a)}parseObject3D({url:e,resource:t,configMap:n,resourceMap:r}){if(r.set(e,t),!Tt[t.type])return void console.warn("can not found support config in vis for this resource",t);const s=Tt[t.type]();if(s.vid=Object(g["a"])(),Dt(t,s,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),s.rotation.x=t.rotation.x,s.rotation.y=t.rotation.y,s.rotation.z=t.rotation.z,n.set(e,s),t.material)if(Array.isArray(t.material))s.material=[],t.material.forEach((t,i,o)=>{const a=`${e}.material.${i}`;this.parseMaterial({url:a,resource:t,configMap:n,resourceMap:r}),s.material.push(n.get(a).vid)});else{const i=e+".material";this.parseMaterial({url:i,resource:t.material,configMap:n,resourceMap:r}),s.material=n.get(i).vid}if(t.geometry){const i=e+".geometry";this.parseGeometry({url:i,resource:t.geometry,configMap:n,resourceMap:r}),s.geometry=n.get(i).vid}t.children&&t.children.length&&t.children.forEach((t,i,o)=>{const a=`${e}.children.${i}`;this.parseObject3D({url:a,resource:t,configMap:n,resourceMap:r}),s.children.push(n.get(a).vid)})}}class zt extends xt{constructor(){super(...arguments),A(this,"selector",(e,t,n)=>t instanceof HTMLElement&&n.get(zt)||null)}parse({url:e,resource:t,configMap:n,resourceMap:r}){const s=Tt[ee.CSS3DPLANE]();s.element=e,r.set(e,t),n.set(e,s)}}class kt extends xt{constructor(){super(...arguments),A(this,"selector",(e,t,n)=>t instanceof r["Ac"]&&n.get(kt)||null)}parse({url:e,resource:t,configMap:n,resourceMap:r}){const s=Tt[ee.LOADTEXTURE]();s.url=e,r.set(e,t),n.set(e,s)}}class Ft extends xt{constructor(){super(),A(this,"object3DParser",new Ht),A(this,"selector",(e,t,n)=>t.parser&&t.animations&&t.scene&&t.scenes&&n.get(Ft)||null)}parse({url:e,resource:t,configMap:n,resourceMap:r}){this.object3DParser.parse({url:e+".scene",resource:t.scene,configMap:n,resourceMap:r})}}class Yt extends I{constructor(e={}){super(),A(this,"configMap",new Map),A(this,"resourceMap",new Map),A(this,"paserMap",new Map),this.addParser(new Rt).addParser(new Ot).addParser(new Ct).addParser(new Ht).addParser(new zt).addParser(new kt).addParser(new Ft);const t=new Map;for(const n in e)t.has(n)&&console.warn(`resourceManager construct params rescource already exist: ${n}, that will be cover.`),t.set(n,e[n]);this.mappingResource(t)}addParser(e){return this.paserMap.has(e.constructor)||this.paserMap.set(e.constructor,e),this}mappingResource(e,t){const n=this.configMap,r=this.resourceMap,s=[...this.paserMap.values()],i={};for(const[o,a]of e.entries()){if((null==t?void 0:t.parser)&&t.parser[o]){t.parser[o].parse({url:o,resource:a,configMap:n,resourceMap:r});continue}if((null==t?void 0:t.selector)&&t.selector[o]){const e=t.selector[o](o,a,this.paserMap);if(!e){console.warn("resource manager hanlder can not found this resource parser: ",a,t.selector[o]);continue}e.parse({url:o,resource:a,configMap:n,resourceMap:r}),i[o]=this.getResourceConfig(o);continue}let e=null;for(const t of s)if(e=t.selector(o,a,this.paserMap),e)break;e?(e.parse({url:o,resource:a,configMap:n,resourceMap:r}),i[o]=this.getResourceConfig(o)):console.warn("resouce manager can not found some handler to parser this resource:",a)}return this.dispatchEvent({type:"mapped",configMap:n,resourceMap:r,resourceConfig:i}),this}getResourceConfig(e){const t=this.configMap,n={};return[...t.keys()].filter(t=>t.startsWith(e)).forEach(e=>{const r=t.get(e);if(r){const e=re(r.type);e?(!n[e]&&(n[e]=[]),n[e].push(r)):console.error("unknow error: can not found module by type: "+r.type,r)}else console.error("unknow error: can not found config by url: "+e)}),n}hasResource(e){return this.resourceMap.has(e)}remove(e){const t=this.configMap,n=this.resourceMap;return[...t.keys()].filter(t=>t.startsWith(e)).forEach(e=>{t.delete(e);const r=n.get(e);r.dispose&&r.dispose(),n.delete(e)}),this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const _t=function(e){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const t=new Yt(e.resources);return this.resourceManager=t,this.loaderManager&&this.loaderManager.addEventListener("loaded",e=>{this.resourceManager.mappingResource(e.resourceMap)}),this.registerResources=e=>{const t=new Map;return Object.keys(e).forEach(n=>{t.set(n,e[n])}),this.resourceManager.mappingResource(t),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0},Wt=(e,t)=>t===1/0?"Infinity":t===-1/0?"-Infinity":t,Vt=(e,t)=>"Infinity"===t?1/0:"-Infinity"===t?-1/0:t,Kt=e=>JSON.parse(JSON.stringify(e,Wt),Vt);class Qt{constructor(e){A(this,"config"),this.config=e}pipe(e){return this.config=e(this.config),this}get(){return this.config}}var $t={stringify:Wt,parse:Vt,clone:Kt,Pipeline:Qt};Symbol.toStringTag;class Jt{constructor(){A(this,"rule"),A(this,"memberSet"),this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(n=>{t(e,n)}),this}}const Xt=new WeakMap,Zt=function(e,t,n,r,s){const i=Reflect.get(e,t,n);return"symbol"===typeof t||r.isIgnore(s)||(s=Nt(s,t),r.next({operate:"get",path:s,key:t,value:e[t]})),i},qt=function(e,t,n,r,s,i){if("symbol"===typeof t||s.isIgnore(i))return Reflect.set(e,t,n,r);if(i=Nt(i,t),Pt(n)&&!Xt.has(n)&&(n=tn(s,n,i)),void 0===e[t]){jt(n)&&Gt(n);const r=Reflect.set(e,t,n);return s.next({operate:"add",path:i,key:t,value:n}),r}const o=Reflect.set(e,t,n);if(jt(e)&&"length"===t){const n=Bt(e);if(!n)return console.error("array value is not be cached:",e),o;const r=n.length-e.length;if(r>0){let o=0,a=0;i=i.slice(0,-t.length);for(const t of n)if(!e.includes(t)&&(s.next({operate:"delete",path:i+a,key:a.toString(),value:t}),o+=1,a+=1,o===r))break}return Gt(e),o}return s.next({operate:"set",path:i,key:t,value:n}),o},en=function(e,t,n,r){if("symbol"===typeof t||n.isIgnore(r))return Reflect.deleteProperty(e,t);r=Nt(r,t);const s=e[t],i=Reflect.deleteProperty(e,t);return jt(e)||n.next({operate:"delete",path:r,key:t,value:s}),i},tn=function(e,t,n=""){if("object"!==typeof t)return t;if(Xt.has(t))return t;if(e.isIgnore(n))return t;const r={get:(t,r,s)=>Zt(t,r,s,e,n),set:(t,r,s,i)=>qt(t,r,s,i,e,n),deleteProperty:(t,r)=>en(t,r,e,n)};if(Pt(t))for(const i in t){const r=Nt(n,i);e.isIgnore(r)||Pt(t[i])&&(jt(t[i])&&Gt(t[i]),t[i]=tn(e,t[i],r))}const s=new Proxy(t,r);return Xt.set(s,e),s};class nn extends E["a"]{constructor(e,t){super(),A(this,"ignore",{}),A(this,"raw"),this.raw=e,t&&(this.ignore=t)}isIgnore(e){let t=this.ignore;for(const n of e.split(".")){if(void 0===t[n])return!1;if("boolean"===typeof t[n]&&t[n])return!0;t=t[n]}return!1}setIgnore(e){this.ignore=e}mergeIgnore(e){this.ignore=Object.assign(this.ignore,e)}}const rn=function(e,t){const n=new nn(e,t);return tn(n,e)},sn=function(e){return Xt.get(e)},on=function(e,t,n){return Reflect.get(e,t,n)},an=function(e,t,n,r,s){if("symbol"===typeof t)return Reflect.set(e,t,n,r);if(void 0===e[t]){const r=Reflect.set(e,t,n);return s.add(n),s.next({operate:"add",path:t,key:t,value:n}),r}{const r=Reflect.set(e,t,n);return s.remove(n.vid),s.add(n),s.next({operate:"set",path:t,key:t,value:n}),r}},cn=function(e,t,n){if("symbol"===typeof t)return Reflect.deleteProperty(e,t);const r=e[t],s=Reflect.deleteProperty(e,t);return n.next({operate:"delete",path:t,key:t,value:r}),n.remove(r.vid),s},ln=class extends E["a"]{constructor(){super(),A(this,"container"),A(this,"subscriptions",new Map),this.container=new Proxy(ln.generator(),{get:on,set:(e,t,n,r)=>an(e,t,n,r,this),deleteProperty:(e,t)=>cn(e,t,this)})}add(e){const t=sn(e);t?this.subscriptions.set(t.raw.vid,t.subscribe(e=>{"get"!==e.operate&&this.next({operate:e.operate,path:Nt(t.raw.vid,e.path),key:e.key,value:e.value})})):console.error("DataContainer: this config can not Obasrvable",e)}remove(e){this.subscriptions.delete(e)}};let hn=ln;A(hn,"generator",()=>({}));class dn{constructor(e,t=[]){A(this,"dataContainer",new hn),A(this,"translater"),this.translater=(new Jt).setRule(e),this.dataContainer.subscribe(e=>{this.translater.translate(e)});for(const n of t)this.addConfig(n)}getData(){return this.dataContainer.container}existSymbol(e){return Boolean(this.dataContainer.container[e])}addConfig(e){return this.dataContainer.container[e.vid]=e,this}getConfig(e){return this.dataContainer.container[e]}removeConfig(e){const t=this.dataContainer.container;void 0!==t[e]&&delete t[e]}addCompiler(e){return e.setTarget(this.dataContainer.container),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),Wt):JSON.stringify(Object.values(this.dataContainer.container),Wt)}exportConfig(e=!0){if(e){const e=this.dataContainer.container,t=[],n={},r=(e,t,n={})=>{for(const s in e)if(["vid","type"].includes(s))n[s]=e[s];else if("object"===typeof e[s]&&null!==e[s]){if(Array.isArray(e[s])){if(!e[s].length)continue;n[s]=e[s].map(e=>"object"===typeof e&&null!==e?Kt(e):e);continue}n[s]={},t[s]?(r(e[s],t[s],n[s]),0===Object.keys(n[s]).length&&delete n[s]):n[s]=Kt(e[s])}else t[s]!==e[s]&&(n[s]=e[s])};for(const s of Object.values(e)){if(!n[s.type]){if(!Tt[s.type]){console.error("can not font some config with: "+s.type);continue}n[s.type]=Tt[s.type]()}const e={};r(s,n[s.type],e),t.push(e)}return t}return Object.values(Kt(this.dataContainer.container))}load(e){const t=this.dataContainer.container,n={},r=(e,t)=>{for(const n in t)"object"===typeof e[n]&&null!==e[n]&&"object"===typeof t[n]&&null!==t[n]?r(e[n],t[n]):void 0===e[n]&&(e[n]=t[n])};for(const s of e){if(!n[s.type]){if(!Tt[s.type]){console.error("can not font some config with: "+s.type);continue}n[s.type]=Tt[s.type]()}r(s,n[s.type]),t[s.vid]=s}return this}remove(e){const t=this.dataContainer.container;for(const n of e)void 0!==t[n.vid]&&delete t[n.vid];return this}getModule(){return this.MODULE}}const pn=(e,t,n=f["a"])=>{const{operate:r,key:s,path:i,value:o}=e;let a=s;const c=i.split(".");i.length&&(a=c.shift(),c.pop()),n(a)?"add"!==r||c.length?"delete"!==e.operate||c.length?"set"!==e.operate||c.length||s!==a?t.compile(a,{operate:r,key:s,path:c,value:o}):t.cover(o):t.remove(o):t.add(o):console.warn(`${t.MODULE} Rule: vid is illeage: ${a}`)},un=function(e,t){pn(e,t)};class mn extends dn{constructor(e=[]){super(un,e),A(this,"MODULE",te.TEXTURE)}}const gn=function(e,t){pn(e,t)};class fn extends dn{constructor(e=[]){super(gn,e),A(this,"MODULE",te.MATERIAL)}}class En extends dn{constructor(e,t=[]){super(e,t),A(this,"MODULE",te.GROUP)}}const yn=function(e,t){"parent"!==e.key&&pn(e,t)},vn=function(e,t){yn(e,t)};class bn extends En{constructor(e=[]){super(vn,e),A(this,"MODULE",te.LIGHT)}}const Mn=function(e,t){pn(e,t)};class Sn extends dn{constructor(e=[]){super(Mn,e),A(this,"MODULE",te.GEOMETRY)}}const wn=function(e,t){yn(e,t)};class Tn extends En{constructor(e=[]){super(wn,e),A(this,"MODULE",te.CAMERA)}}const xn=function(e,t){pn(e,t,e=>Object(f["a"])(e)||[qe(ee.WEBGLRENDERER),qe(ee.CSS3DRENDERER)].includes(e))};class Rn extends dn{constructor(e=[]){super(xn,e),A(this,"MODULE",te.RENDERER)}}const On=function(e,t){pn(e,t,e=>Object(f["a"])(e)||[qe(ee.SCENE)].includes(e))};class Cn extends En{constructor(e=[]){super(On,e),A(this,"MODULE",te.SCENE)}}const Ln=function(e,t){pn(e,t,e=>Object(f["a"])(e)||[qe(ee.TRNASFORMCONTROLS),qe(ee.ORBITCONTROLS)].includes(e))};class An extends dn{constructor(e=[]){super(Ln,e),A(this,"MODULE",te.CONTROLS)}}class In extends dn{constructor(e,t=[]){super(e,t),A(this,"MODULE",te.MESH)}}const Dn=function(e,t){"geometry"!==e.key&&yn(e,t)};class Pn extends In{constructor(e=[]){super(Dn,e),A(this,"MODULE",te.SPRITE)}}const jn=function(e,t){yn(e,t)};class Nn extends In{constructor(e=[]){super(jn,e),A(this,"MODULE",te.LINE)}}const Un=function(e,t){yn(e,t)};class Gn extends In{constructor(e=[]){super(Un,e),A(this,"MODULE",te.MESH)}}const Bn=function(e,t){yn(e,t)};class Hn extends In{constructor(e=[]){super(Bn,e),A(this,"MODULE",te.POINTS)}}const zn=function(e,t){yn(e,t)};class kn extends En{constructor(e=[]){super(zn,e),A(this,"MODULE",te.GROUP)}}const Fn=function(e,t){pn(e,t)};class Yn extends dn{constructor(e=[]){super(Fn,e),A(this,"MODULE",te.PASS)}}const _n=function(e,t){"name"===e.key&&1===e.path.length||pn(e,t)};class Wn extends dn{constructor(e=[]){super(_n,e),A(this,"MODULE",te.ANIMATION)}}const Vn=function(e,t){yn(e,t)};class Kn extends En{constructor(e=[]){super(Vn,e),A(this,"MODULE",te.CSS3D)}}const Qn=function(e,t){yn(e,t)};class $n extends En{constructor(e=[]){super(Qn,e),A(this,"MODULE",te.OBJECT3D)}}const Jn=function(e,t){yn(e,t)};class Xn extends En{constructor(e=[]){super(Jn,e),A(this,"MODULE",te.CSS2D)}}class Zn{constructor(e){A(this,"object3DDataSupport",new $n),A(this,"cameraDataSupport",new Tn),A(this,"lightDataSupport",new bn),A(this,"geometryDataSupport",new Sn),A(this,"textureDataSupport",new mn),A(this,"materialDataSupport",new fn),A(this,"rendererDataSupport",new Rn),A(this,"sceneDataSupport",new Cn),A(this,"controlsDataSupport",new An),A(this,"spriteDataSupport",new Pn),A(this,"lineDataSupport",new Nn),A(this,"meshDataSupport",new Gn),A(this,"pointsDataSupport",new Hn),A(this,"groupDataSupport",new kn),A(this,"css3DDataSupport",new Kn),A(this,"css2DDataSupport",new Xn),A(this,"passDataSupport",new Yn),A(this,"animationDataSupport",new Wn),A(this,"dataSupportMap"),e&&Object.keys(e).forEach(t=>{void 0!==this[t]&&(this[t]=e[t])});const t=new Map;Object.keys(this).forEach(e=>{const n=this[e];n instanceof dn&&t.set(n.MODULE,n)}),this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn("can not found this type in dataSupportManager: "+e),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn("can not found this type in dataSupportManager: "+e),null)}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const n of t){const t=n.getConfig(e);if(t)return t}return null}removeConfigBySymbol(...e){const t=this.dataSupportMap.values();for(const n of e)for(const e of t)if(e.existSymbol(n)){e.removeConfig(n);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const n of t)if(n.existSymbol(e))return n.MODULE;return null}applyConfig(...e){for(const t of e){const e=re(t.type);e?this.dataSupportMap.get(e).addConfig(t):console.warn("dataSupportManager can not found this config module: "+t.type)}return this}load(e){const t=this.dataSupportMap;return t.forEach((t,n)=>{e[n]&&t.load(e[n])}),this}remove(e){const t=this.dataSupportMap;return t.forEach((t,n)=>{e[n]&&t.remove(e[n])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),Wt)}exportConfig(e={},t=!0){const n=this.dataSupportMap;return n.forEach((n,r)=>{e[r]=n.exportConfig(t)}),e}}const qn=function(e){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const t=new Zn(e);return this.dataSupportManager=t,this.applyConfig=function(...e){return this.dataSupportManager.applyConfig(...e),this},this.getConfigBySymbol=function(e){return this.dataSupportManager.getConfigBySymbol(e)},this.removeConfigBySymbol=function(...e){return this.dataSupportManager.removeConfigBySymbol(...e),this},this.toJSON=function(){if(this.loaderManager){const e={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(e)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let e={};return this.loaderManager&&(e={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(e)},!0},er=class{constructor(){A(this,"target",{}),A(this,"map",new Map),A(this,"weakMap",new WeakMap),A(this,"engine"),A(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!er.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const t=er.processors.get(e.type),n=t.create(e,this.engine);return this.map.set(e.vid,n),this.weakMap.set(n,e.vid),this.engine.compilerManager.emit(e.vid,{}),n}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!er.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const n=this.map.get(t);return er.processors.get(e.type).dispose(n),this.map.delete(t),this.weakMap.delete(n),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{Dt(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const n=this.cacheCompile;let r,s,i;if(n&&n.vid===e)r=n.target,s=n.config,i=n.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(r=this.map.get(e),s=this.target[e],!er.processors.has(s.type))return console.warn("PassCompiler can not support this type: "+s.type),this;i=er.processors.get(s.type),this.cacheCompile={target:r,config:s,processor:i,vid:e}}return i.process({config:s,target:r,engine:this.engine,processor:i,compiler:this,...t}),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);er.processors.has(e.type)?er.processors.get(e.type).dispose(t):console.warn(`${this.MODULE}  can not support this type: ${e.type}`)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let tr=er;A(tr,"processors",new Map),A(tr,"processor",(function(e){er.processors.set(e.configType,e)}));const nr="vis.scriptAni";class rr{constructor(e){A(this,"configType"),A(this,"commands"),A(this,"create"),A(this,"dispose"),this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate])return void this[e.operate](e);let t=this.commands[e.operate];for(const n of[].concat(e.path,e.key)){if(!t[n]&&!t.$reg)return void this[e.operate](e);if(t[n]){if("function"===typeof t[n])return void t[n](e);t=t[n]}else if(t.$reg)for(const r of t.$reg)if(r.reg.test(n))return void r.handler(e)}this[e.operate](e)}add(e){let t=e.target;const n=e.path;for(const r of n){if(void 0===typeof t[r])return void console.warn("processor can not exec default add operate.",e);t=t[r]}t[e.key]=e.value}set(e){let t=e.target;const n=e.path;for(const r of n){if(void 0===typeof t[r])return void console.warn("processor can not exec default set operate.",e);t=t[r]}t[e.key]=e.value}delete(e){let t=e.target;const n=e.path;for(const r of n){if(void 0===typeof t[r])return void console.warn("processor can not exec default delete operate.",e);t=t[r]}delete t[e.key]}}const sr=e=>new rr(e),ir=function(){},or={name:"linearTime",multiply:1},ar=function(e,t,n,r){return void 0===t[n]?(console.warn("object not exist attribute: "+n,t),e=>{}):"number"!==typeof t[n]?(console.warn("object attribute is not typeof number.",t,n),e=>{}):e=>{t[n]+=e.delta*r.multiply}},cr={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},lr=function(e,t,n,r){if(void 0===t[n])return console.warn("object not exist attribute: "+n,t),e=>{};if("number"!==typeof t[n])return console.warn("object attribute is not typeof number.",t,n),e=>{};const s=t[n];return e=>{t[n]=s+r.amplitude*Math.sin(e.total*r.speed/r.wavelength)+r.offset}},hr=class{static generateConfig(e,t){if(!hr.configLibrary.has(e))return console.warn("event library can not found config by name: "+e),{name:""};const n=(e,t)=>{for(const r in t)void 0!==e[r]&&("object"!==typeof t[r]||null===t[r]||Array.isArray(t[r])?e[r]=t[r]:n(e[r],t[r]))},r=JSON.parse(JSON.stringify(hr.configLibrary.get(e)));return n(r,t),r}static generateScript(e,t,n,r){return hr.generatorLibrary.has(r.name)?hr.generatorLibrary.get(r.name)(e,t,n,r):(console.error("event library can not found generator by name: "+r.name),()=>{})}static has(e){return hr.configLibrary.has(e)}};let dr=hr;A(dr,"configLibrary",new Map),A(dr,"generatorLibrary",new Map),A(dr,"register",(function(e,t){hr.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),hr.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),hr.generatorLibrary.set(e.name,t)})),dr.register(or,ar),dr.register(cr,lr);const pr=function(e,t){let n=t.compilerManager.getObjectBySymbol(e.target);if(!n)return console.warn("can not found object in enigne: "+e.target),()=>{};const r=e.attribute.split(".");r.shift();const s=r.pop();for(const i of r){if(void 0===n[i])return console.warn("animaton processor: target object can not found key: "+i,n),()=>{};n=n[i]}return dr.generateScript(t,n,s,e.script)};var ur=sr({configType:ee.SCRIPTANIMATION,commands:{set:{play({target:e,engine:t,value:n}){n?t.renderManager.addEventListener("render",e):t.renderManager.removeEventListener("render",e)},$reg:[{reg:new RegExp(".*"),handler({config:e,engine:t}){const n=e[Symbol.for(nr)];t.renderManager.removeEventListener("render",n);const r=pr(e,t);e[Symbol.for(nr)]=r,e.play&&t.renderManager.addEventListener("render",n)}}]}},create(e,t){const n=pr(e,t);return e.play&&t.renderManager.addEventListener("render",n),e[Symbol.for(nr)]=n,n},dispose(){}});class mr extends tr{constructor(){super(),A(this,"MODULE",te.ANIMATION)}restoreAttribute(e){if(!e.target||!e.attribute)return this;let t=this.engine.getObjectBySymbol(e.target),n=this.engine.getConfigBySymbol(e.target);t&&n||console.warn("AnimationCompiler: can not found object target or config in engine",e.vid);const r=e.attribute.split(".");r.shift();const s=r.pop();for(const i of r){if(!t[i]||!n[i])return console.warn("AnimationCompiler: object and config attribute are not sync"),this;t=t[i],n=n[i]}return t[s]=n[s],this}cover(e){super.cover(e);const t=this.map.get(e.vid);return e[Symbol.for(nr)]=t,this}remove(e){return this.engine.removeEventListener("render",e[Symbol.for(nr)]),this.restoreAttribute(e),delete e[Symbol.for(nr)],super.remove(e),this}compile(e,t){const n=this.target[e];this.restoreAttribute(n),super.compile(e,t);const r=this.map.get(e),s=n[Symbol.for(nr)];return this.map.set(n.vid,s),this.weakMap.delete(r),this.weakMap.set(s,e),this}}tr.processor(ur);class gr extends tr{constructor(){super()}}const fr={name:"openWindow",params:{url:""}},Er=function(e,t){return()=>{window.open(t.params.url)}},yr={name:"visibleObject",params:{target:"",visible:!0,delay:0}},vr=function(e,t){const n=t.params,r=e.getObjectBySymbol(n.target);return r?()=>{setTimeout(()=>{r.visible=n.visible},n.delay)}:(console.warn("basic event visibleObject: can not found vid object: "+n.target),()=>{})},br={name:"addClass",params:{target:"",className:"",delay:0}},Mr=function(e,t){const n=t.params,r=[];if("all"===n.target)e.scene.traverse(e=>{e instanceof y["a"]&&r.push(e)});else if(Array.isArray(n.target))n.target.forEach(t=>{const s=e.getObjectBySymbol(t);s?r.push(s):console.warn("basic event AddClass: can not found vid object: "+n.target)});else{const t=e.getObjectBySymbol(n.target);if(!t)return console.warn("basic event AddClass: can not found vid object: "+n.target),()=>{};if(!(t instanceof y["a"]))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};r.push(t)}return r.length?()=>{setTimeout(()=>{r.forEach(e=>{e.element.classList.add(n.className)})},n.delay)}:(console.warn("basic event AddClass: can not found vid object: "+n.target),()=>{})},Sr={name:"changeScene",params:{scene:"Scene",delay:0}},wr=function(e,t){const n=t.params;return()=>{setTimeout(()=>{e.setScene(n.scene)},n.delay)}},Tr={name:"changeCamera",params:{camera:"",delay:0}},xr=function(e,t){const n=t.params;return()=>{setTimeout(()=>{e.setCamera(n.camera)},n.delay)}},Rr={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},Or=function(e,t){const n=t.params,r=e.getConfigBySymbol(n.target);return r?()=>{setTimeout(()=>{if("auto"===n.toggle)return r.play,void r.play;"off"!==n.toggle?"on"!==n.toggle||(r.play=!0):r.play=!1},n.delay)}:(console.warn("basic event switchAnimate: can not found vid config: "+n.target),()=>{})};var Cr=(e=>(e["ELN"]="ELN",e["EQI"]="EQI",e["EQO"]="EQO",e["EASING_LINEAR_NONE"]="EASING_LINEAR_NONE",e["EASING_QUARTIC_IN"]="EASING_QUARTIC_IN",e["EASING_QUARTIC_OUT"]="EASING_QUARTIC_OUT",e["EASING_QUARTIC_INOUT"]="EASING_QUARTIC_INOUT",e["EASING_QUADRATIC_IN"]="EASING_QUADRATIC_IN",e["EASING_QUADRATIC_OUT"]="EASING_QUADRATIC_OUT",e["EASING_QUADRATIC_INOUT"]="EASING_QUADRATIC_INOUT",e))(Cr||{});const Lr={ELN:v["a"].Linear.None,EQI:v["a"].Quartic.In,EQO:v["a"].Quartic.Out,EASING_LINEAR_NONE:v["a"].Linear.None,EASING_QUARTIC_IN:v["a"].Quartic.In,EASING_QUARTIC_OUT:v["a"].Quartic.Out,EASING_QUARTIC_INOUT:v["a"].Quartic.InOut,EASING_QUADRATIC_IN:v["a"].Quadratic.In,EASING_QUADRATIC_OUT:v["a"].Quadratic.Out,EASING_QUADRATIC_INOUT:v["a"].Quadratic.InOut},Ar={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT}},Ir=function(e,t){const n=t.params,r=e.compilerManager,s=r.getObjectBySymbol(n.target);if(!s)return console.warn("real time animation moveTO: can not found vid object: "+n.target),()=>{};const i=e.renderManager,o=e.dataSupportManager.getConfigBySymbol(n.target);if(!o)return console.warn("can not found object config: "+n.target),()=>{};let a=!1;return()=>{if(a)return;a=!0;const e=new v["b"](s.position).to(n.position).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),t=t=>{e.update()};i.addEventListener("render",t),e.onComplete(()=>{i.removeEventListener("render",t),o.position.x=n.position.x,o.position.y=n.position.y,o.position.z=n.position.z,a=!1})}},Dr={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT}},Pr=function(e,t){const n=t.params,r=e.compilerManager,s=r.getObjectBySymbol(n.target);if(!s)return console.warn("real time animation moveTO: can not found vid object: "+n.target),()=>{};const i=e.renderManager,o=e.dataSupportManager.getConfigBySymbol(n.target);if(!o)return console.warn("can not found object config: "+n.target),()=>{};let a=!1;return()=>{if(a)return;a=!0;const e=new v["b"](s.rotation).to(n.rotation).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),t=t=>{e.update()};i.addEventListener("render",t),e.onComplete(()=>{i.removeEventListener("render",t),o.rotation.x=n.rotation.x,o.rotation.y=n.rotation.y,o.rotation.z=n.rotation.z,a=!1})}},jr={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT}},Nr=function(e,t){const n=t.params,r=e.compilerManager,s=r.getObjectBySymbol(n.target);if(!s)return console.warn("real time animation upTo: can not found vid object: "+n.target),()=>{};const i=e.renderManager,o=e.dataSupportManager.getConfigBySymbol(n.target);if(!o)return console.warn("can not found object config: "+n.target),()=>{};let a=!1;return()=>{if(a)return;a=!0;const e=new v["b"](s.up).to(n.up).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),t=t=>{e.update()};i.addEventListener("render",t),e.onComplete(()=>{i.removeEventListener("render",t),o.up.x=n.up.x,o.up.y=n.up.y,o.up.z=n.up.z,a=!1})}},Ur={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT}},Gr=function(e,t){const n=t.params,r=e.compilerManager,s=r.getObjectBySymbol(n.target);if(!s)return console.warn("real time animation moveTO: can not found vid object: "+n.target),()=>{};const i=e.renderManager,o=e.dataSupportManager.getConfigBySymbol(n.target);if(!o)return console.warn("can not found object config: "+n.target),()=>{};let a=!1;return()=>{if(a)return;a=!0,s.position.set(n.from.x,n.from.y,n.from.z),s.updateMatrix(),s.updateMatrixWorld();const e=new v["b"](s.position).to(n.to).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),t=t=>{e.update()};i.addEventListener("render",t),e.onComplete(()=>{i.removeEventListener("render",t),o.position.x=n.to.x,o.position.y=n.to.y,o.position.z=n.to.z,a=!1})}},Br={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT}},Hr=function(e,t){const n=t.params,s=e.getObjectBySymbol(n.target);if(!s)return console.warn("can not found vid object: "+n.target),()=>{};if(!(s instanceof r["Eb"]))return console.warn("object is not instanceof Object3D: "+n.target),()=>{};const i=e.renderManager,o=e.getConfigBySymbol(n.target);let a=!1;return()=>{if(a)return;a=!0;const e={x:s.position.x+n.spacing.x,y:s.position.y+n.spacing.y,z:s.position.z+n.spacing.z},t=new v["b"](s.position).to(e).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),r=e=>{t.update()};i.addEventListener("render",r),t.onComplete(()=>{i.removeEventListener("render",r),o.position.x=e.x,o.position.y=e.y,o.position.z=e.z,a=!1})}},zr={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT}},kr=function(e,t){const n=t.params,r=e.compilerManager,s=r.getObjectBySymbol(n.target),i=r.getObjectBySymbol(n.to);if(!s)return console.warn("real time animation MoveToObject: can not found vid object: "+n.target),()=>{};if(!i)return console.warn("real time animation MoveToObject: can not found vid object: "+n.target),()=>{};const o=e.renderManager,a=e.dataSupportManager.getConfigBySymbol(n.target);if(!a)return console.warn("can not found object config: "+n.target),()=>{};let c=!1;return()=>{if(c)return;c=!0;const e={x:i.position.x+n.offset.x,y:i.position.y+n.offset.y,z:i.position.z+n.offset.z},t=new v["b"](s.position).to(e).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),r=e=>{t.update()};o.addEventListener("render",r),t.onComplete(()=>{o.removeEventListener("render",r),a.position.x=e.x,a.position.y=e.y,a.position.z=e.z,c=!1})}},Fr={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:Cr.EASING_QUADRATIC_INOUT}},Yr=function(e,t){var n,r,s;const i=t.params,o=e.compilerManager.getObjectBySymbol(i.target);if(!o)return console.warn("real time animation vector3To: can not found vid object: "+i.target),()=>{};const a=e.renderManager;let c=e.dataSupportManager.getConfigBySymbol(i.target);if(!c)return console.warn("real time animation vector3To: can not found object config: "+i.target),()=>{};const l=i.attribute.split(".");l.shift();let h=o;for(const m of l){if(void 0===h[m])return console.error("real time animation vector3To: object can not support key: "+m,o),()=>{};h=h[m],c=c[m]}const d=i.props;if(!(d.x in h)||!(d.y in h)||!(d.z in h))return console.error("real time animation vector3To: object can not support props:",h,d),()=>{};if(!(d.x in c)||!(d.y in c)||!(d.z in c))return console.error("real time animation vector3To: config can not support props:",c,d),()=>{};const p={x:null!=(n=i.to.x)?n:h[d.x],y:null!=(r=i.to.y)?r:h[d.y],z:null!=(s=i.to.z)?s:h[d.z]};let u=!1;return()=>{if(u)return;u=!0;const e=new v["b"](h).to(p).duration(i.duration).delay(i.delay).easing(Lr[i.timingFunction]).start(),t=t=>{e.update()};a.addEventListener("render",t),e.onComplete(()=>{a.removeEventListener("render",t),c[d.x]=p.x,c[d.y]=p.y,c[d.z]=p.z,u=!1})}},_r={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT,back:!0}},Wr=function(e,t){const n=t.params,s=e.getObjectBySymbol(n.target),i=e.orbitControls.target;if(!s)return console.warn("real time animation focusObject: can not found vid object: "+n.target),()=>{};if(!(s instanceof r["Eb"]))return console.warn("real time animation focusObject: vid object is not a class of THREE.Object3D: "+n.target),()=>{};let o=!1;const a=new r["I"];return()=>{if(o)return;o=!0;let t=e.camera;n.camera&&(t=e.getObjectBySymbol(n.camera),t||(t=e.camera,console.warn("real time animation focusObject: can not found camera config: "+n.camera)));const c=e.getObjectConfig(t),l=e.orbitControls&&e.orbitControls.object===t;c||console.warn("engine current camera can not found config.");const h=e.renderManager;let d={x:s.matrixWorld.elements[12]+n.offset.x,y:s.matrixWorld.elements[13]+n.offset.y,z:s.matrixWorld.elements[14]+n.offset.z};const p={x:t.position.x,y:t.position.y,z:t.position.z};if("local"===n.space){const e=new r["Kc"](n.offset.x,n.offset.y,n.offset.z).applyEuler(a.setFromRotationMatrix(s.matrixWorld));d={x:s.matrixWorld.elements[12]+e.x,y:s.matrixWorld.elements[13]+e.y,z:s.matrixWorld.elements[14]+e.z}}const u=new v["b"](t.position).to(d).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start();let m;const g={x:t.up.x,y:t.up.y,z:t.up.z};if("local"===n.space){const e=new r["Kc"](0,1,0).applyEuler(a.setFromRotationMatrix(s.matrixWorld));m=new v["b"](t.up).to({x:e.x,y:e.y,z:e.z}).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start()}let f;const E={x:i.x,y:i.y,z:i.z};let y;l&&(f=new v["b"](i).to({x:s.matrixWorld.elements[12],y:s.matrixWorld.elements[13],z:s.matrixWorld.elements[14]}).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start()),y=l&&"local"===n.space?e=>{u.update(),m.update(),f.update()}:l?e=>{u.update(),f.update()}:"local"===n.space?e=>{u.update(),m.update()}:e=>{u.update()},h.addEventListener("render",y),u.onComplete(()=>{if(h.removeEventListener("render",y),c&&(c.position.x=d.x,c.position.y=d.y,c.position.z=d.z),o=!1,n.back){const e=()=>{const r=new v["b"](t.position).to(p).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start();let s,o;"local"===n.space&&(s=new v["b"](t.up).to(g).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start()),l&&(o=new v["b"](i).to(E).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start());const a=e=>{r.update(),s&&s.update(),o&&o.update()};r.onComplete(()=>{h.removeEventListener("render",a)}),h.addEventListener("render",a),document.removeEventListener("dblclick",e)};document.addEventListener("dblclick",e)}})}},Vr={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:Cr.EASING_QUADRATIC_INOUT,visible:!0}},Kr=function(e,t){const n=t.params,s=e.getObjectBySymbol(n.target);if(!s)return console.warn("real time animation fadeObject: can not found vid object: "+n.target),()=>{};const i=e.getObjectConfig(s);if(!i.material)return console.warn("real time animation fadeObject: target can not support fade: "+n.target),()=>{};const o=[],a=[],c=Array.isArray(i.material)?[].concat(i.material):[i.material];for(const h of c){const t=e.getObjectBySymbol(h),n=e.getConfigBySymbol(h);t instanceof r["mb"]?n?(o.push(t),a.push(n)):console.error("real time animation fadeObject: object config material can not found config: "+h):console.error("real time animation fadeObject: object config material is not instanceof Material: "+h)}let l=!1;return()=>{if(l)return;l=!0;const t=e.renderManager;i.visible=!0,o.forEach((e,r,s)=>{e.visible=!0,e.transparent=!0,e.opacity="in"===n.direction?0:1,e.needsUpdate=!0;const o=new v["b"](e).to({opacity:"in"===n.direction?1:0}).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),c=e=>{o.update()};t.addEventListener("render",c),o.onComplete(()=>{t.removeEventListener("render",c),"out"===n.direction&&n.visible?(a[r].visible=!1,i.visible=!1):"in"===n.direction&&n.visible&&(a[r].visible=!0,i.visible=!0),a[r].opacity="in"===n.direction?1:0,l=!1})})}},Qr={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT,back:!0}},$r=function(e,t){const n=t.params,s=e.getObjectBySymbol(n.target),i=e.getConfigBySymbol(n.target),o=e.camera;if(!s)return console.warn("real time animation showToCamera: can not found vid object: "+n.target),()=>{};if(!s)return console.warn("real time animation showToCamera: can not found vid config: "+n.target),()=>{};if(!(s instanceof r["Eb"]))return console.warn("real time animation showToCamera: vid object is not a class of THREE.Object3D: "+n.target),()=>{};const a=new r["pb"],c=new r["I"],l=new r["Kc"];let h=!1;return()=>{if(h)return;h=!0;const t=e.renderManager;l.set(n.offset.x,n.offset.y,n.offset.z).applyEuler(o.rotation),l.set(o.position.x+l.x,o.position.y+l.y,o.position.z+l.z),a.lookAt(o.position,l,o.up),c.setFromRotationMatrix(a);const r={x:s.position.x,y:s.position.y,z:s.position.z},d={x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},p=new v["b"](s.position).to({x:l.x,y:l.y,z:l.z}).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),u=new v["b"](s.rotation).to({x:c.x,y:c.y,z:c.z}).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),m=e=>{p.update(),u.update()};t.addEventListener("render",m),p.onComplete(()=>{if(t.removeEventListener("render",m),i.position.x=l.x,i.position.y=l.y,i.position.z=l.z,i.rotation.x=c.x,i.rotation.y=c.y,i.rotation.z=c.z,h=!1,n.back){const e=()=>{const o=new v["b"](s.position).to(r).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),a=new v["b"](s.rotation).to(d).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),c=e=>{o.update(),a.update()};o.onComplete(()=>{t.removeEventListener("render",c),i.position.x=r.x,i.position.y=r.y,i.position.z=r.z,i.rotation.x=d.x,i.rotation.y=d.y,i.rotation.z=d.z}),t.addEventListener("render",c),document.removeEventListener("dblclick",e)};document.addEventListener("dblclick",e)}})}},Jr={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:Cr.EASING_QUADRATIC_INOUT}},Xr=function(e,t){const n=t.params,s=e.getObjectBySymbol(n.target);if(!s)return console.warn("real time animation ColorChange: can not found vid material: "+n.target),()=>{};if(!s[n.attribute]||!(s[n.attribute]instanceof r["t"]))return console.warn("real time animation ColorChange: material attribute is illeage: "+n.attribute),()=>{};const i=e.getConfigBySymbol(n.target);if(!i)return console.warn("real time animation ColorChange: can not found material config: "+n.target),()=>{};const o=new r["t"](n.color),a=e.renderManager;let c=!1;return()=>{if(c)return;c=!0;const e=new v["b"](s[n.attribute]).to({r:o.r,g:o.g,b:o.b}).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),t=t=>{e.update()};a.addEventListener("render",t),e.onComplete(()=>{a.removeEventListener("render",t),i[n.attribute]=n.color,c=!1})}},Zr={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Cr.EASING_QUADRATIC_INOUT}},qr=function(e,t){const n=t.params;if(e.compilerManager,!e.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const r=e.renderManager;let s=!1;return()=>{if(s)return;s=!0;let t=n.offset;if(n.target){const r=e.getObjectBySymbol(n.target);r?t={x:r.matrixWorld.elements[12]+t.x,y:r.matrixWorld.elements[13]+t.y,z:r.matrixWorld.elements[14]+t.z}:console.warn("real time animation orbitTargetMove: can not found vid object: "+n.target)}const i=new v["b"](e.orbitControls.target).to(t).duration(n.duration).delay(n.delay).easing(Lr[n.timingFunction]).start(),o=e=>{i.update()};r.addEventListener("render",o),i.onComplete(()=>{r.removeEventListener("render",o),s=!1})}},es=class{static generateConfig(e,t){if(!es.configLibrary.has(e))return console.warn("event library can not found config by name: "+e),{name:""};const n=(e,t)=>{for(const r in t)"object"!==typeof t[r]||null===t[r]||Array.isArray(t[r])?e[r]=t[r]:n(e[r],t[r])},r=JSON.parse(JSON.stringify(es.configLibrary.get(e)));return n(r,t),r}static generateEvent(e,t){return es.generatorLibrary.has(e.name)?es.generatorLibrary.get(e.name)(t,e):(console.error("event library can not found generator by name: "+e.name),()=>{})}static has(e){return es.configLibrary.has(e)}};let ts=es;A(ts,"configLibrary",new Map),A(ts,"generatorLibrary",new Map),A(ts,"register",(function(e,t){es.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),es.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),es.generatorLibrary.set(e.name,t)})),ts.register(fr,Er),ts.register(yr,vr),ts.register(br,Mr),ts.register(Sr,wr),ts.register(Tr,xr),ts.register(Rr,Or),ts.register(Ar,Ir),ts.register(Dr,Pr),ts.register(jr,Nr),ts.register(Ur,Gr),ts.register(Br,Hr),ts.register(zr,kr),ts.register(Fr,Yr),ts.register(_r,Wr),ts.register(Vr,Kr),ts.register(Qr,$r),ts.register(Jr,Xr),ts.register(Zr,qr);class ns{constructor(){A(this,"list",[]),A(this,"timer"),A(this,"time",0)}exec(e){e(!1)||(this.list.includes(e)||this.list.push(e),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{for(const e of this.list)e(!0);this.list=[]},this.time))}append(e){this.list.length&&!this.list.includes(e)?this.list.push(e):this.exec(e)}force(e){setTimeout(()=>{e()},this.time)}}const rs=new ns,ss=new WeakMap,is=function({target:e,config:t,value:n,engine:r}){if(t.vid===n)return void console.warn("can not set object lookAt itself.");let s=ss.get(e);if(s||(s={lookAtTarget:null,updateMatrixWorldFun:null},ss.set(e,s)),!n){if(!s.updateMatrixWorldFun)return;return e.updateMatrixWorld=s.updateMatrixWorldFun,s.lookAtTarget=null,void(s.updateMatrixWorldFun=null)}rs.exec(t=>{const i=r.compilerManager.getObject3D(n);if(!i)return t&&console.warn(`lookAt handler can not found this vid mapping object: '${n}'`),!1;const o=e.updateMatrixWorld;return s.updateMatrixWorldFun=o,s.lookAtTarget=i.position,e.updateMatrixWorld=t=>{o.call(e,t),e.lookAt(s.lookAtTarget)},!0})},os="vis.event",as=function({target:e,path:t,value:n,engine:r}){const s=t[0];if(!ts.has(n.name))return void console.warn("EventLibrary: can not support this event: "+n.name);const i=ts.generateEvent(n,r),o=Symbol.for(os);n[o]=i,e.addEventListener(s,i)},cs=function({target:e,path:t,value:n}){const r=t[0],s=n[Symbol.for(os)];s?(e.removeEventListener(r,s),delete n[Symbol.for(os)]):console.warn("event remove can not fun found event in config",n)},ls=function({target:e,config:t,path:n,engine:r}){if(n.length<2)return;const s=n[0],i=t[n[0]][n[1]],o=i[Symbol.for(os)];if(!o)return void console.warn("event remove can not fun found event in config",i);e.removeEventListener(s,o);const a=ts.generateEvent(i,r);i[Symbol.for(os)]=a,e.addEventListener(s,a)},hs=function({target:e,config:t,value:n,engine:r}){rs.exec(s=>{const i=r.getConfigBySymbol(n);if(!i)return s&&console.warn(" can not foud object config in engine: "+n),!1;if(i.parent&&i.parent!==t.vid){const e=r.getConfigBySymbol(i.parent);if(!e)return s&&console.warn(" can not foud object parent config in engine: "+i.parent),!1;e.children.splice(e.children.indexOf(n),1)}i.parent=t.vid;const o=r.compilerManager.getObject3D(n);return o?(e.add(o),!0):(s&&console.warn(`can not found this vid in engine: ${n}.`),!1)})},ds=function({target:e,config:t,value:n,engine:r}){const s=r.compilerManager.getObject3D(n);if(!s)return void console.warn(`can not found this vid in engine: ${n}.`);e.remove(s);const i=r.getConfigBySymbol(n);i?i.parent="":console.warn(`can not found this vid in engine: ${n}.`)},ps=function(e,t,n,r){Promise.resolve(),!n.lookAt&&is({target:e,config:t,engine:r,value:t.lookAt}),t.children.forEach(n=>{hs({target:e,config:t,value:n,engine:r})});for(const s of Object.values(Y))rs.force(()=>(t[s].forEach((t,n)=>{as({target:e,path:[s,n.toString()],value:t,engine:r})}),!0));return Dt(t,e,{vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0,...n}),e},us=function(e){e._listener={}},ms={add:{pointerdown:as,pointerup:as,pointermove:as,pointerenter:as,pointerleave:as,click:as,dblclick:as,contextmenu:as,children:hs},set:{lookAt:is,pointerdown:ls,pointerup:ls,pointermove:ls,pointerenter:ls,pointerleave:ls,click:ls,dblclick:ls,contextmenu:ls,parent:ir,children:{$reg:[{reg:new RegExp(".*"),handler:hs}]}},delete:{pointerdown:cs,pointerup:cs,pointermove:cs,pointerenter:cs,pointerleave:cs,click:cs,dblclick:cs,contextmenu:cs,children:ds}};sr({configType:ee.OBJECT3D,commands:ms,create(e,t){return ps(new r["Eb"],e,{},t)},dispose:us});const gs=new WeakMap;var fs=sr({configType:ee.PERSPECTIVECAMERA,commands:{add:{scale(){},...ms.add},set:{scale(){},adaptiveWindow({target:e,value:t,engine:n}){if(t){if(!gs.has(t)){const t=t=>{e.aspect=t.width/t.height,e.updateProjectionMatrix()};gs.set(e,t),n.addEventListener("setSize",t),t({type:"setSize",width:n.dom.offsetWidth,height:n.dom.offsetHeight})}}else{const t=gs.get(e);t&&(n.removeEventListener("setSize",t),gs.delete(e))}},...ms.set,$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:e,key:t,value:n}){e[t]=n,e.updateProjectionMatrix()}}]},delete:{scale(){},...ms.delete}},create(e,t){const n=new r["Lb"];if(ps(n,e,{scale:!0,adaptiveWindow:!0},t),n.updateProjectionMatrix(),e.adaptiveWindow){const e=e=>{n.aspect=e.width/e.height,n.updateProjectionMatrix()};gs.set(n,e),t.addEventListener("setSize",e),e({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return n},dispose(e){gs.delete(e),us(e)}}),Es=sr({configType:ee.ORTHOGRAPHICCAMERA,commands:{add:{scale(){},...ms.add},set:{scale(){},adaptiveWindow({target:e,value:t,engine:n}){if(t){if(!gs.has(t)){const t=t=>{const n=t.width,r=t.height;e.left=-n,e.right=n,e.top=r,e.bottom=-r,e.updateProjectionMatrix()};gs.set(e,t),n.addEventListener("setSize",t),t({type:"setSize",width:n.dom.offsetWidth,height:n.dom.offsetHeight})}}else{const t=gs.get(e);t&&(n.removeEventListener("setSize",t),gs.delete(e))}},...ms.set,$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:e,key:t,value:n}){e[t]=n,e.updateProjectionMatrix()}}]},delete:{scale(){},...ms.delete}},create(e,t){const n=new r["Ib"](-50,50,50,-50);if(ps(n,e,{scale:!0,adaptiveWindow:!0},t),n.updateProjectionMatrix(),e.adaptiveWindow){const e=e=>{const t=e.width,r=e.height;n.left=-t,n.right=t,n.top=r,n.bottom=-r,n.updateProjectionMatrix()};gs.set(n,e),t.addEventListener("setSize",e),e({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return n},dispose(e){gs.delete(e),us(e)}});class ys extends gr{constructor(){super(),A(this,"MODULE",te.CAMERA)}}tr.processor(fs),tr.processor(Es);var vs=sr({configType:ee.ORBITCONTROLS,commands:{set:{target({target:e,config:t,path:n,key:s,value:i}){const o=t.target;t.type?"string"===typeof t.target||(n.length>1?e.target[s]=i:e.target=new r["Kc"](o.x,o.y,o.z)):t.target=new r["Kc"](0,0,0)}}},create(e,t){let n;return t.orbitControls?n=t.orbitControls:(n=new j,n.setCamera(t.camera),n.setDom(t.dom)),e.target&&("string"===typeof e.target||(n.target=new r["Kc"](e.target.x,e.target.y,e.target.z))),Dt(e,n,{target:!0}),n},dispose(e){e.dispose()}}),bs=sr({configType:ee.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:e,config:t,value:n}){n?(e.translationSnap=t.translationSnap,e.rotationSnap=t.rotationSnap,e.scaleSnap=t.scaleSnap):(e.translationSnap=null,e.rotationSnap=null,e.scaleSnap=null)},translationSnap({target:e,config:t,value:n}){t.snapAllow&&(e.translationSnap=n)},rotationSnap({target:e,config:t,value:n}){t.snapAllow&&(e.rotationSnap=n)},scaleSnap({target:e,config:t,value:n}){t.snapAllow&&(e.scaleSnap=n)}}},create(e,t){let n;return t.transformControls?n=t.transformControls:(n=new K,n.setCamera(t.camera),t.dom&&n.setDom(t.dom)),e.snapAllow&&(n.translationSnap=e.translationSnap,n.rotationSnap=e.rotationSnap,n.scaleSnap=e.scaleSnap),n},dispose(e){e.dispose()}});class Ms extends tr{constructor(){super(),A(this,"MODULE",te.CONTROLS)}useEngine(e){return e.transformControls&&(this.map.set(qe(ee.TRNASFORMCONTROLS),e.transformControls),this.weakMap.set(e.transformControls,qe(ee.TRNASFORMCONTROLS))),e.orbitControls&&(this.map.set(qe(ee.ORBITCONTROLS),e.orbitControls),this.weakMap.set(e.orbitControls,qe(ee.ORBITCONTROLS))),super.useEngine(e)}}tr.processor(vs),tr.processor(bs);const Ss=function(e,t){const n=t.resourceManager.resourceMap;if(!n.has(e))return console.warn("css3D compiler: can not found resource element: "+e),document.createElement("div");const r=n.get(e);return r instanceof HTMLElement?r:(console.warn("css3D compiler can not suport render this resource type.",r.constructor,e),document.createElement("div"))};var ws=sr({configType:ee.CSS3DOBJECT,commands:{add:ms.add,set:{element({target:e,value:t,engine:n}){e.element=Ss(t,n)},...ms.set},delete:ms.delete},create(e,t){return ps(new y["a"](Ss(e.element,t)),e,{element:!0},t)},dispose:us});class Ts extends y["a"]{constructor(e=document.createElement("div")){const t=document.createElement("div"),n=50,s=50;t.style.width=n+"px",t.style.height=s+"px",t.appendChild(e),super(t),A(this,"geometry"),A(this,"_width"),A(this,"_height"),this.geometry=new r["Mb"](n,s),this.geometry.computeBoundingBox(),this._width=n,this._height=s}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new r["Mb"](e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=e+"px",this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new r["Mb"](this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=e+"px",this._height=e}}class xs extends Ts{constructor(e=document.createElement("div")){super(e),A(this,"cacheBox",new r["g"]),this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,t){const n=this.cacheBox.copy(this.geometry.boundingBox);n.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(n)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var Rs=sr({configType:ee.CSS3DPLANE,commands:{add:ms.add,set:{element({target:e,value:t,engine:n}){e.element.innerHTML="",e.element.appendChild(Ss(t,n))},...ms.set},delete:ms.delete},create(e,t){return ps(new xs(Ss(e.element,t)),e,{element:!0},t)},dispose:us});class Os extends y["c"]{constructor(e=document.createElement("div")){const t=document.createElement("div"),n=50,s=50;t.style.width=n+"px",t.style.height=s+"px",t.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite"),super(t),A(this,"geometry"),A(this,"_width"),A(this,"_height"),A(this,"cacheBox",new r["g"]),A(this,"cachePosition",new r["Kc"]),A(this,"cacheQuaternion",new r["Tb"]),A(this,"cacheScale",new r["Kc"]),A(this,"cacheMatrix4",new r["pb"]),A(this,"rotateMatrix4",new r["pb"]),this.geometry=new r["Mb"](n,s),this.geometry.computeBoundingBox(),this._width=n,this._height=s,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new r["Mb"](e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=e+"px",this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new r["Mb"](this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=e+"px",this._height=e}raycast(e,t){const n=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const r=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(r),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),n.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(n)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}class Cs extends Os{constructor(e=document.createElement("div")){super(e),this.type="CSS3DSprite",this.element.classList.add("vis-css3d","vis-css3d-plane")}}var Ls=sr({configType:ee.CSS3DSPRITE,commands:{add:ms.add,set:{element({target:e,value:t,engine:n}){e.element.innerHTML="",e.element.appendChild(Ss(t,n))},...ms.set},delete:ms.delete},create(e,t){return ps(new Cs(Ss(e.element,t)),e,{element:!0},t)},dispose:us});class As extends gr{constructor(){super(),A(this,"MODULE",te.CSS3D)}}tr.processor(Rs),tr.processor(ws),tr.processor(Ls);class Is extends r["k"]{constructor(e=[],t=36,n=!0){super(),A(this,"parameters"),this.type="CurveGeometry",this.parameters={path:e.map(e=>e.clone()),space:n,divisions:t}}}class Ds extends Is{constructor(e=[],t=36,n=!0){super(e,t,n),this.type="QuadraticBezierCurveGeometry";const s=new r["z"];if(e.length<3)return void console.warn("QuadraticBezierCurveGeometry path length at least 3.");const i=e.length-3+3-(e.length-3)%2;for(let a=1;a<i;a+=2)s.add(new r["Sb"](e[a-1],e[a],e[a+1]));const o=s.curves.reduce((e,t)=>e+t.arcLengthDivisions,0);if(t>o){const e=Math.ceil((t-o)/s.curves.length);s.curves.forEach(t=>{t.arcLengthDivisions=t.arcLengthDivisions*(e+1),t.updateArcLengths()})}this.setFromPoints(n?s.getSpacedPoints(t):s.getPoints(t))}}class Ps extends Is{constructor(e=[],t=36,n=!0){super(e,t,n),this.type="CubicBezierCurveGeometry";const s=new r["z"];if(e.length<4)return void console.warn("CubicBezierCurveGeometry path length at least 4.");const i=e.length-4+4-(e.length-4)%3;for(let a=2;a<i;a+=3)s.add(new r["y"](e[a-2],e[a-1],e[a],e[a+1]));const o=s.curves.reduce((e,t)=>e+t.arcLengthDivisions,0);if(t>o){const e=Math.ceil((t-o)/s.curves.length);s.curves.forEach(t=>{t.arcLengthDivisions=t.arcLengthDivisions*(e+1),t.updateArcLengths()})}this.setFromPoints(n?s.getSpacedPoints(t):s.getPoints(t))}}class js extends Is{constructor(e=[],t=36,n=!0){if(super(e,t,n),this.type="LineCurveGeometry",!e.length)return void console.warn("LineCurveGeometry path length at least 1.");const s=new r["z"];for(let o=1;o<e.length;o+=1)s.add(new r["cb"](e[o-1],e[o]));const i=s.curves.reduce((e,t)=>e+t.arcLengthDivisions,0);if(t>i){const e=Math.ceil((t-i)/s.curves.length);s.curves.forEach(t=>{t.arcLengthDivisions=t.arcLengthDivisions*(e+1),t.updateArcLengths()})}this.setFromPoints(n?s.getSpacedPoints(t):s.getPoints(t))}}class Ns extends Is{constructor(e=[],t=36,n=!0){if(super(e,t,n),this.type="SplineCurveGeometry",!e.length)return void console.warn("SplineCurveGeometry path length at least 1.");const s=new r["p"](e);this.setFromPoints(n?s.getSpacedPoints(t):s.getPoints(t))}}class Us extends r["Fc"]{constructor(e=[],t=64,n=1,s=8,i=!1){if(!e.length)return void console.warn("LineTubeGeometry path length at least 1.");const o=new r["z"];for(let a=1;a<e.length;a+=1)o.add(new r["cb"](e[a-1],e[a]));super(o,t,n,s,i),this.type="LineTubeGeometry"}}class Gs extends r["Fc"]{constructor(e=[],t=64,n=1,s=8,i=!1){if(!e.length)return void console.warn("SplineTubeGeometry path length at least 1.");const o=new r["p"](e);super(o,t,n,s,i),this.type="SplineTubeGeometry"}}class Bs extends r["mc"]{constructor(e=[new r["Jc"](0,0)],t=12){const n=new r["lc"],s=e[0];if(s){n.moveTo(s.x,s.y);for(let t=1;t<e.length;t+=1)n.lineTo(e[t].x,e[t].y)}super(n,t),this.type="LineShapeGeometry"}}const Hs=function(e,t){e instanceof Is||e instanceof r["Fc"]||e instanceof r["nc"]||e.center(),e.computeBoundingBox();const n=e.boundingBox,s=t.position,i=t.rotation,o=t.scale,a=(new r["Tb"]).setFromEuler(new r["I"](i.x,i.y,i.z,"XYZ"));return e.applyQuaternion(a),e.scale(o.x,o.y,o.z),e instanceof Is||e instanceof r["Fc"]||e instanceof r["nc"]||e.center(),e.computeBoundingBox(),e.translate((n.max.x-n.min.x)/2*s.x,(n.max.y-n.min.y)/2*s.y,(n.max.z-n.min.z)/2*s.z),e},zs={reg:new RegExp(".*"),handler({config:e,target:t,processor:n,engine:r}){const s=n.create(e,r);t.copy(s),t.dispatchEvent({type:"update"}),t.uuid=s.uuid,s.dispose()}},ks={add:{groups({target:e,value:t}){e.addGroup(t.start,t.count,t.materialIndex)},$reg:[zs]},set:{groups(e){const{path:t,target:n,config:r}=e;if(void 0!==t[1]){n.groups.splice(Number(e.path[1]),1);const s=r.groups[t[1]];n.addGroup(s.start,s.count,s.materialIndex)}else console.warn("geometry processor can not set group",e)},$reg:[zs]},delete:{groups({target:e,key:t}){e.groups.splice(Number(t),1)},$reg:[zs]}},Fs=function(e,t){e.clearGroups();for(const n of t.groups)e.addGroup(n.start,n.count,n.materialIndex);return Hs(e,t)},Ys=new Map;Ys.set(ee.BOXGEOMETRY,e=>new r["h"](e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)),Ys.set(ee.SPHEREGEOMETRY,e=>new r["rc"](e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)),Ys.set(ee.PLANEGEOMETRY,e=>new r["Mb"](e.width,e.height,e.widthSegments,e.heightSegments)),Ys.set(ee.CIRCLEGEOMETRY,e=>new r["q"](e.radius,e.segments,e.thetaStart,e.thetaLength)),Ys.set(ee.CONEGEOMETRY,e=>new r["v"](e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)),Ys.set(ee.CYLINDERGEOMETRY,e=>new r["A"](e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)),Ys.set(ee.LINECURVEGEOMETRY,e=>new js(e.path.map(e=>new r["Kc"](e.x,e.y,e.z)),e.divisions,e.space)),Ys.set(ee.SPLINECURVEGEOMETRY,e=>new Ns(e.path.map(e=>new r["Kc"](e.x,e.y,e.z)),e.divisions,e.space)),Ys.set(ee.CUBICBEZIERCURVEGEOMETRY,e=>new Ps(e.path.map(e=>new r["Kc"](e.x,e.y,e.z)),e.divisions,e.space)),Ys.set(ee.QUADRATICBEZIERCURVEGEOMETRY,e=>new Ds(e.path.map(e=>new r["Kc"](e.x,e.y,e.z)),e.divisions,e.space)),Ys.set(ee.LINETUBEGEOMETRY,e=>new Us(e.path.map(e=>new r["Kc"](e.x,e.y,e.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed)),Ys.set(ee.SPLINETUBEGEOMETRY,e=>new Gs(e.path.map(e=>new r["Kc"](e.x,e.y,e.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed)),Ys.set(ee.TORUSGEOMETRY,e=>new r["Cc"](e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)),Ys.set(ee.RINGGEOMETRY,e=>new r["ic"](e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)),Ys.set(ee.LINESHAPEGEOMETRY,e=>new Bs(e.path.map(e=>new r["Jc"](e.x,e.y)),e.curveSegments));const _s=function(e){return Ys.has(e.type)?Fs(Ys.get(e.type)(e),e):(console.error("parametric geometry can not support this type config: "+e.type),new r["k"])},Ws=function(e){e.dispose()},Vs=function(e){return sr({configType:e,commands:ks,create:_s,dispose:Ws})},Ks=[ee.BOXGEOMETRY,ee.SPHEREGEOMETRY,ee.PLANEGEOMETRY,ee.CIRCLEGEOMETRY,ee.CONEGEOMETRY,ee.CYLINDERGEOMETRY,ee.LINECURVEGEOMETRY,ee.SPLINECURVEGEOMETRY,ee.CUBICBEZIERCURVEGEOMETRY,ee.QUADRATICBEZIERCURVEGEOMETRY,ee.LINETUBEGEOMETRY,ee.SPLINETUBEGEOMETRY,ee.TORUSGEOMETRY,ee.RINGGEOMETRY,ee.LINESHAPEGEOMETRY],Qs=Ks.map(e=>Vs(e));class $s extends r["k"]{constructor(e){super(),A(this,"type","LoadBufferGeometry"),e&&this.copy(e)}}var Js=sr({configType:ee.LOADGEOMETRY,commands:ks,create(e,t){const n=t.resourceManager.resourceMap.get(e.url);return n||n instanceof r["k"]?Fs(new $s(n),e):(console.error("engine rescoure can not found url: "+e.url),new r["h"](5,5,5))},dispose(e){e.dispose()}});const Xs=function(e){const t=new r["k"];return e.position.length&&t.setAttribute("position",new r["K"](e.position,3)),e.color.length&&t.setAttribute("color",new r["K"](e.color,3)),e.normal.length&&t.setAttribute("normal",new r["K"](e.normal,3)),e.uv.length&&t.setAttribute("uv",new r["K"](e.uv,2)),e.uv2.length&&t.setAttribute("uv2",new r["K"](e.uv2,2)),e.index.length&&t.setIndex(e.index),t};var Zs=sr({configType:ee.CUSTOMGEOMETRY,commands:ks,create(e){return Fs(Xs(e.attribute),e)},dispose(e){e.dispose()}}),qs=sr({configType:ee.EDGESGEOMETRY,commands:ks,create(e,t){const n=t.compilerManager.getObjectBySymbol(e.url);return n&&n instanceof r["k"]?Fs(new r["H"](n),e):(console.error("engine rescoure can not found url: "+e.url),new r["H"](new r["h"](5,5,5)))},dispose(e){e.dispose()}});class ei extends tr{constructor(){super(),A(this,"MODULE",te.GEOMETRY)}}Qs.forEach(e=>{tr.processor(e)}),tr.processor(Js),tr.processor(Zs),tr.processor(qs);var ti=sr({configType:ee.GROUP,commands:ms,create(e,t){return ps(new r["Q"],e,{},t)},dispose:us});class ni extends gr{constructor(){super(),A(this,"MODULE",te.GROUP)}}tr.processor(ti);const ri=function({target:e,value:t}){e.color.copy(new r["t"](t))},si=function(e,t,n,s){return e.color.copy(new r["t"](t.color)),ps(e,t,{color:!0,scale:!0,rotation:!0,lookAt:!0,...n},s)},ii=Object.assign({},ms,{set:{color:ri,scale:ir,rotation:ir,lookAt:ir}});var oi=sr({configType:ee.AMBIENTLIGHT,commands:ii,create(e,t){return si(new r["c"],e,{},t)},dispose:us}),ai=sr({configType:ee.DIRECTIONALLIGHT,commands:ii,create(e,t){return si(new r["F"],e,{},t)},dispose:us}),ci=sr({configType:ee.POINTLIGHT,commands:ii,create(e,t){return si(new r["Ob"],e,{},t)},dispose:us}),li=sr({configType:ee.SPOTLIGHT,commands:ii,create(e,t){return si(new r["uc"],e,{},t)},dispose:us});class hi extends gr{constructor(){super(),A(this,"MODULE",te.LIGHT)}}tr.processor(oi),tr.processor(ai),tr.processor(ci),tr.processor(li);class di extends gr{constructor(){super()}}const pi=new r["kc"]({fragmentShader:"\n  void main () {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);\n  }\n  "}),ui=new r["h"](10,10,10),mi=function({target:e,value:t,engine:n}){rs.exec(r=>{const s=n.compilerManager.getGeometry(t);return s?(e.geometry=s,!0):(r&&console.warn("can not found geometry by vid in engine: "+t),e.geometry=ui,!1)})},gi=function({target:e,config:t,engine:n}){rs.exec(r=>{let s;return s="string"===typeof t.material?n.compilerManager.getMaterial(t.material)||pi:t.material.map(e=>n.compilerManager.getMaterial(e)||pi),e.material=s,!(Array.isArray(s)&&s.length&&s[0]===pi||s===pi)})},fi=function(e,t,n,r){return n.geometry||(e.geometry.dispose(),mi({target:e,value:t.geometry,engine:r})),n.material||gi({target:e,config:t,engine:r}),ps(e,t,{geometry:!0,material:!0,...n},r)},Ei=function(e){us(e)},yi={add:{material:gi,...ms.add},set:{geometry:mi,material:gi,...ms.set},delete:{material:gi,...ms.delete}};var vi=sr({configType:ee.LINE,commands:yi,create(e,t){return fi(new r["ab"],e,{},t)},dispose:Ei});class bi extends di{constructor(){super(),A(this,"MODULE",te.LINE)}}tr.processor(vi);const Mi={reg:new RegExp("transparent|sizeAttenuation"),handler({target:e,key:t,value:n}){e[t]=n,e.needsUpdate=!0}},Si=function({target:e,key:t,value:n,engine:s}){rs.exec(i=>{const o=s.compilerManager.getObjectBySymbol(n);return o instanceof r["Ac"]?(e[t]=o,e.needsUpdate=!0,!0):(i&&console.warn("this url resource is not instance of Texture: "+t,n,o),e[t]=null,!1)})},wi={reg:new RegExp("map$","i"),handler:Si},Ti=function({target:e,key:t,value:n}){e[t].copy(new r["t"](n))},xi=function(e,t,n){const s={};for(const i of Object.keys(t))i.toLocaleLowerCase().endsWith("map")&&t[i]?(Si({target:e,key:i,value:t[i],engine:n}),s[i]=!0):e[i]instanceof r["t"]&&(e[i]=new r["t"](t[i]),s[i]=!0);return Dt(t,e,s),e.needsUpdate=!0,e},Ri=function(e){e.dispose()};var Oi=sr({configType:ee.LINEBASICMATERIAL,commands:{set:{color:Ti,$reg:[wi,Mi]}},create:function(e,t){return xi(new r["bb"],e,t)},dispose:Ri}),Ci=sr({configType:ee.MESHBASICMATERIAL,commands:{set:{color:Ti,$reg:[wi,Mi]}},create:function(e,t){return xi(new r["rb"],e,t)},dispose:Ri}),Li=sr({configType:ee.MESHPHONGMATERIAL,commands:{set:{color:Ti,emissive:Ti,specular:Ti,$reg:[wi,Mi]}},create:function(e,t){return xi(new r["tb"],e,t)},dispose:Ri}),Ai=sr({configType:ee.MESHPHYSICALMATERIAL,commands:{set:{color:Ti,emissive:Ti,specularColor:Ti,sheenColor:Ti,attenuationColor:Ti,$reg:[wi,Mi]}},create:function(e,t){return xi(new r["ub"],e,t)},dispose:Ri}),Ii=sr({configType:ee.MESHSTANDARDMATERIAL,commands:{set:{color:Ti,emissive:Ti,$reg:[wi,Mi]}},create:function(e,t){return xi(new r["vb"],e,t)},dispose:Ri}),Di=sr({configType:ee.POINTSMATERIAL,commands:{set:{color:Ti,$reg:[wi,Mi]}},create:function(e,t){return xi(new r["Qb"],e,t)},dispose:Ri});const Pi={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:"\n    varying vec2 vUv;\n\n    void main () {\n\n      vUv = uv;\n\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }",fragmentShader:"\n    uniform float width;\n    uniform float time;\n    uniform vec3 color;\n    uniform vec2 center;\n\n    varying vec2 vUv;\n\n    void main () {\n      // 根据uTime求出百分比\n      float deg = mod(degrees(time), 360.0);\n      if (deg > 0.0 && deg < 180.0) {\n        discard;\n      }\n\n      float percent = cos(time);\n      float distancePercent = distance(center, vUv);\n\n      // 从外向里\n      if (distancePercent > 0.5) {\n        discard;\n      }\n\n      if (distancePercent < percent) {\n        discard;\n      }\n\n      if (distancePercent - percent > width) {\n        discard;\n      }\n\n      float opacity =  (width - (distancePercent - percent)) / width;\n\n      // float opacity = distancePercent;\n      gl_FragColor = vec4(color, opacity);\n    }"},ji={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:"\n  void main () {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }",fragmentShader:"\n    uniform vec2 resolution;\n\n    void main () {\n      vec2 st = gl_FragCoord.xy / resolution;\n      gl_FragColor = vec4(st.x,st.y,0.0,1.0);\n    }"},Ni={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:"\n  void main () {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }",fragmentShader:"\n    uniform vec3 colorA;\n    uniform vec3 colorB;\n    uniform float percent;\n\n    void main () {\n      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);\n    }"},Ui={name:"BloomShader",uniforms:{brightness:{value:.8},extend:{value:5},specular:{value:.9},outFade:{value:2},inFade:{value:.3},color:{value:{r:1,g:1,b:1}}},vertexShader:"\n  uniform float extend;\n\n  varying vec3 vNormal;\n  varying vec3 vView;\n\n  void main () {\n\n    vec3 extendPosition = position + normalize(position) * extend;\n\n    vNormal = normalize(position);\n    vView = normalize(cameraPosition - (modelMatrix * vec4(extendPosition , 1.0 )).xyz);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );\n  }",fragmentShader:"\n    uniform vec3 color;\n    uniform float brightness;\n    uniform float specular;\n    uniform float outFade;\n    uniform float inFade;\n\n    varying vec3 vNormal;\n    varying vec3 vView;\n    \n    void main () {\n\n      float present = smoothstep(0.0, 1.0, dot(vView, vNormal));\n\n      if (present >= specular) {\n        present = pow(smoothstep(1.0, specular, present), inFade);\n      } else {\n        present = pow(smoothstep(0.0, specular, present), outFade);\n      }\n\n      gl_FragColor = vec4(color, present * brightness);\n    }"},Gi=class{static getShader(e){return Gi.library.has(e)?Gi.cloneShader(Gi.library.get(e)):(console.warn("con not found shader in shader library: "+e),null)}static generateConfig(e){if(!Gi.library.has(e))return console.warn("con not found shader in shader library: "+e),{};const t=Gi.library.get(e),n={shader:e,uniforms:{}};return t.uniforms&&(n.uniforms=JSON.parse(JSON.stringify(t.uniforms))),n}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let Bi=Gi;A(Bi,"library",new Map),A(Bi,"reigster",(function(e){Gi.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),Gi.library.set(e.name,e)}));const Hi={name:"defaultShader"};Bi.reigster(Hi),Bi.reigster(Pi),Bi.reigster(ji),Bi.reigster(Ni),Bi.reigster(Ui);var zi=sr({configType:ee.SHADERMATERIAL,commands:{set:{shader({target:e,value:t}){const n=Bi.getShader(t);(null==n?void 0:n.vertexShader)&&(e.vertexShader=n.vertexShader),(null==n?void 0:n.fragmentShader)&&(e.fragmentShader=n.fragmentShader),(null==n?void 0:n.uniforms)&&(e.uniforms=n.uniforms),(null==n?void 0:n.defines)&&(e.defines=n.defines),e.needsUpdate=!0},$reg:[Mi]}},create:function(e,t){const n=new r["kc"],s=Bi.getShader(e.shader);return(null==s?void 0:s.vertexShader)&&(n.vertexShader=s.vertexShader),(null==s?void 0:s.fragmentShader)&&(n.fragmentShader=s.fragmentShader),(null==s?void 0:s.uniforms)&&(n.uniforms=s.uniforms),(null==s?void 0:s.defines)&&(n.defines=s.defines),Dt(e,n,{type:!0,shader:!0}),n.needsUpdate=!0,n},dispose:Ri}),ki=sr({configType:ee.SPRITEMATERIAL,commands:{set:{color:Ti,$reg:[wi,Mi]}},create:function(e,t){return xi(new r["wc"],e,t)},dispose:Ri});class Fi extends tr{constructor(){super(),A(this,"MODULE",te.MATERIAL)}}tr.processor(Ci),tr.processor(Ii),tr.processor(Li),tr.processor(Oi),tr.processor(Di),tr.processor(ki),tr.processor(Oi),tr.processor(zi),tr.processor(Ai);var Yi=sr({configType:ee.MESH,commands:yi,create(e,t){return fi(new r["qb"],e,{},t)},dispose:Ei});class _i extends di{constructor(){super(),A(this,"MODULE",te.MESH)}}tr.processor(Yi);var Wi=sr({configType:ee.OBJECT3D,commands:ms,create(e,t){return ps(new r["Eb"],e,{},t)},dispose:us});class Vi extends gr{constructor(){super(),A(this,"MODULE",te.OBJECT3D)}}tr.processor(Wi);var Ki=sr({configType:ee.SMAAPASS,create(e,t){const n=window.devicePixelRatio,r=new x["a"](t.dom?t.dom.offsetWidth*n:window.innerWidth*n,t.dom?t.dom.offsetHeight*n:window.innerWidth*n);return r},dispose(e){}}),Qi=sr({configType:ee.UNREALBLOOMPASS,create(e,t){const n=window.devicePixelRatio,s=new R["a"](new r["Jc"](t.dom?t.dom.offsetWidth*n:window.innerWidth*n,t.dom?t.dom.offsetHeight*n:window.innerWidth*n),e.strength,e.radius,e.threshold);return s},dispose(e){e.dispose()}});const $i=class extends S["b"]{constructor(e=new r["Jc"](256,256),t=1,n=0,s=0,i=new r["jc"],o=new r["Lb"],a){super(),A(this,"resolution"),A(this,"strength"),A(this,"radius"),A(this,"threshold"),A(this,"selectedObjects",[]),A(this,"renderScene"),A(this,"renderCamera"),A(this,"clearColor",new r["t"](0,0,0)),A(this,"renderTargetsHorizontal",[]),A(this,"renderTargetsVertical",[]),A(this,"nMips",5),A(this,"selectRenderTarget"),A(this,"renderTargetBright"),A(this,"highPassUniforms"),A(this,"materialHighPassFilter"),A(this,"separableBlurMaterials",[]),A(this,"compositeMaterial"),A(this,"bloomTintColors"),A(this,"mixMaterial"),A(this,"enabled",!0),A(this,"needsSwap",!1),A(this,"_oldClearColor",new r["t"]),A(this,"oldClearAlpha",1),A(this,"basic",new r["rb"]),A(this,"fsQuad",new S["a"]),A(this,"materialCache",new Map),A(this,"sceneBackgroundCache",null),A(this,"overrideBackground",new r["t"]("black")),A(this,"overrideMeshMaterial",new r["rb"]({color:"black"})),A(this,"overrideLineMaterial",new r["bb"]({color:"black"})),A(this,"overridePointsMaterial",new r["Qb"]({color:"black"})),A(this,"overrideSpriteMaterial",new r["wc"]({color:"black"})),this.resolution=e,this.strength=t,this.radius=n,this.threshold=s,this.renderScene=i,this.renderCamera=o,this.selectedObjects=a;let c=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.selectRenderTarget=new r["Nc"](c,l),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new r["Nc"](c,l),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let u=0;u<this.nMips;u++){const e=new r["Nc"](c,l);e.texture.name="UnrealBloomPass.h"+u,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const t=new r["Nc"](c,l);t.texture.name="UnrealBloomPass.v"+u,t.texture.generateMipmaps=!1,this.renderTargetsVertical.push(t),c=Math.round(c/2),l=Math.round(l/2)}void 0===w["a"]&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const h=w["a"];this.highPassUniforms=r["Hc"].clone(h.uniforms),this.highPassUniforms["luminosityThreshold"].value=s,this.highPassUniforms["smoothWidth"].value=.01,this.materialHighPassFilter=new r["kc"]({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}});const d=[3,5,7,9,11];c=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let u=0;u<this.nMips;u++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(d[u])),this.separableBlurMaterials[u].uniforms["texSize"].value=new r["Jc"](c,l),c=Math.round(c/2),l=Math.round(l/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms["blurTexture1"].value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms["blurTexture2"].value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms["blurTexture3"].value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms["blurTexture4"].value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms["blurTexture5"].value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms["bloomStrength"].value=t,this.compositeMaterial.uniforms["bloomRadius"].value=.1,this.compositeMaterial.needsUpdate=!0;const p=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms["bloomFactors"].value=p,this.bloomTintColors=[new r["Kc"](1,1,1),new r["Kc"](1,1,1),new r["Kc"](1,1,1),new r["Kc"](1,1,1),new r["Kc"](1,1,1)],this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let n=Math.round(e/2),s=Math.round(t/2);this.selectRenderTarget.setSize(n,s),this.renderTargetBright.setSize(n,s);for(let i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,s),this.renderTargetsVertical[i].setSize(n,s),this.separableBlurMaterials[i].uniforms["texSize"].value=new r["Jc"](n,s),n=Math.round(n/2),s=Math.round(s/2)}render(e,t,n,s,i){if(!this.selectedObjects.length)return void(this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)));e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1);const a=new Map;for(const r of this.selectedObjects)a.set(r,!0);const c=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(e=>{a.has(e)||e.isLight||!e.visible||(c.set(e,e.material),e instanceof r["qb"]?e.material=this.overrideMeshMaterial:e instanceof r["ab"]?e.material=this.overrideLineMaterial:e instanceof r["Pb"]?e.material=this.overridePointsMaterial:e instanceof r["vc"]&&(e.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms["tDiffuse"].value=this.selectRenderTarget.texture,this.highPassUniforms["luminosityThreshold"].value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let l=this.renderTargetBright;for(let r=0;r<this.nMips;r++)this.fsQuad.material=this.separableBlurMaterials[r],this.separableBlurMaterials[r].uniforms["colorTexture"].value=l.texture,this.separableBlurMaterials[r].uniforms["direction"].value=$i.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[r]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[r].uniforms["colorTexture"].value=this.renderTargetsHorizontal[r].texture,this.separableBlurMaterials[r].uniforms["direction"].value=$i.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[r]),e.clear(),this.fsQuad.render(e),l=this.renderTargetsVertical[r];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms["bloomStrength"].value=this.strength,this.compositeMaterial.uniforms["bloomRadius"].value=this.radius,this.compositeMaterial.uniforms["bloomTintColors"].value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms["bloom"].value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms["origin"].value=n.texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o;for(const r of c.entries())r[0].material=r[1];c.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new r["kc"]({blending:r["b"],depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:"\n    \n        varying vec2 vUv;\n    \n        void main() {\n    \n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    \n        }",fragmentShader:"\n        uniform sampler2D bloom;\n        uniform sampler2D origin;\n    \n        varying vec2 vUv;\n    \n        void main() {\n          vec3 bloomColor = texture2D(bloom, vUv).rgb;\n          vec3 originColor = texture2D(origin, vUv).rgb;\n          gl_FragColor = vec4(originColor + bloomColor, 1.0);\n        }"})}getSeperableBlurMaterial(e){return new r["kc"]({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new r["Jc"](.5,.5)},direction:{value:new r["Jc"](.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new r["kc"]({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}};let Ji=$i;A(Ji,"BlurDirectionX",new r["Jc"](1,0)),A(Ji,"BlurDirectionY",new r["Jc"](0,1));var Xi=sr({configType:ee.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:e,engine:t,value:n}){const r=t.compilerManager.getObject3D(n);r?e.selectedObjects.push(r):console.warn("selectiveBloomPassProcessor: can not found vid in engine: "+n)}},set:{renderScene({target:e,engine:t,value:n}){const s=t.compilerManager.getObject3D(n);s instanceof r["jc"]&&(e.renderScene=s)},renderCamera({target:e,engine:t,value:n}){const s=t.compilerManager.getObject3D(n);s instanceof r["m"]&&(e.renderCamera=s)},selectedObjects({target:e,config:t,engine:n}){const r=t.selectedObjects.map(e=>{const t=n.compilerManager.getObject3D(e);return t||void console.warn("selectiveBloomPassProcessor: can not found vid in engine: "+e)}).filter(e=>e);e.selectedObjects=r}},delete:{selectedObjects({target:e,engine:t,value:n}){const r=t.compilerManager.getObject3D(n);r?e.selectedObjects.includes(r)&&e.selectedObjects.splice(e.selectedObjects.indexOf(r),1):console.warn("selectiveBloomPassProcessor: can not found vid in engine: "+n)}}},create(e,t){const n=[];for(const r of e.selectedObjects){const e=t.compilerManager.getObject3D(r);e&&n.push(e)}const s=window.devicePixelRatio,i=new Ji(new r["Jc"](t.dom?t.dom.offsetWidth*s:window.innerWidth*s,t.dom?t.dom.offsetHeight*s:window.innerWidth*s),e.strength,e.radius,e.threshold,e.renderScene&&t.compilerManager.getObject3D(e.renderScene)||void 0,e.renderCamera&&t.compilerManager.getObject3D(e.renderCamera)||void 0,n);return i},dispose(e){e.dispose()}});class Zi extends tr{constructor(){super(),A(this,"MODULE",te.PASS),A(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const t=super.add(e);return t&&this.composer.addPass(t),t}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const t=this.map.get(e.vid);return this.composer.removePass(t),super.remove(e),this}}tr.processor(Ki),tr.processor(Qi),tr.processor(Xi);var qi=sr({configType:ee.POINTS,commands:yi,create(e,t){return fi(new r["Pb"],e,{},t)},dispose:Ei});class eo extends di{constructor(){super(),A(this,"MODULE",te.POINTS)}}tr.processor(qi);var to=sr({configType:ee.WEBGLRENDERER,commands:{set:{size({target:e,config:t}){t.size?e.setSize(t.size.x,t.size.y):e.setSize(e.domElement.offsetWidth,e.domElement.offsetHeight)},clearColor({target:e,value:t}){const n=Number(t.slice(0,-1).split(",").pop().trim());e.setClearColor(t,n),e.clear()},viewport({target:e,config:t}){const n=t.viewport;if(n)e.setViewport(n.x,n.y,n.width,n.height);else{const t=e.domElement;e.setViewport(0,0,t.offsetWidth,t.offsetHeight)}},scissor({target:e,config:t}){const n=t.scissor;if(n)e.setScissorTest(!0),e.setScissor(n.x,n.y,n.width,n.height);else{e.setScissorTest(!1);const t=e.domElement;e.setScissor(0,0,t.offsetWidth,t.offsetHeight)}},pixelRatio({target:e,value:t}){e.setPixelRatio(t),e.clear()}}},create(e,t){let n;if(n=t.webGLRenderer?t.webGLRenderer:new r["Oc"],e.size&&n.setSize(e.size.x,e.size.y),e.clearColor){const t=Number(e.clearColor.slice(0,-1).split(",").pop().trim());n.setClearColor(e.clearColor,t)}if(e.viewport){const t=e.viewport;n.setViewport(t.x,t.y,t.width,t.height)}if(e.scissor){const t=e.scissor;n.setScissorTest(!0),n.setScissor(t.x,t.y,t.width,t.height)}return e.pixelRatio&&n.setPixelRatio(e.pixelRatio),Dt(e,n,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),n},dispose(e){e.clear(),e.dispose()}}),no=sr({configType:ee.CSS3DRENDERER,commands:{set:{size({target:e,config:t}){t.size?e.setSize(t.size.x,t.size.y):e.setSize(e.domElement.offsetWidth,e.domElement.offsetHeight)}}},create(e,t){let n;return n=t.css3DRenderer?t.css3DRenderer:new y["b"],e.size&&n.setSize(e.size.x,e.size.y),Dt(e,n,{size:!0}),n},dispose(e){}});class ro extends tr{constructor(){super(),A(this,"MODULE",te.RENDERER)}useEngine(e){return e.webGLRenderer&&(this.map.set(qe(ee.WEBGLRENDERER),e.webGLRenderer),this.weakMap.set(e.webGLRenderer,qe(ee.WEBGLRENDERER))),e.css3DRenderer&&(this.map.set(qe(ee.CSS3DRENDERER),e.css3DRenderer),this.weakMap.set(e.css3DRenderer,qe(ee.CSS3DRENDERER))),super.useEngine(e)}}tr.processor(to),tr.processor(no);const so=function(e,t,n){if(t)if(Object(f["a"])(t)){const r=n.compilerManager.getTexture(t);r?e.background=r:console.warn(`engine can not found this vid texture : '${t}'`)}else e.background=new r["t"](t);else e.background=null},io=function(e,t,n){if(t)if(Object(f["a"])(t)){const r=n.compilerManager.getTexture(t);r?e.environment=r:console.warn(`engine can not found this vid texture : '${t}'`)}else console.warn("scene environment is illeage: "+t);else e.environment=null};var oo=sr({configType:ee.SCENE,commands:{add:ms.add,set:{...ms.set,lookAt(){},fog({target:e,config:t,key:n,value:s}){const i=t.fog;i.type?"Fog"===i.type?e.fog&&e.fog instanceof r["M"]?"color"===n?e.fog.color.copy(new r["t"](i.color)):e.fog[n]&&(e.fog[n]=s):e.fog=new r["M"](i.color,i.near,i.far):"FogExp2"===i.type&&(e.fog&&e.fog instanceof r["N"]?"color"===n?e.fog.color.copy(new r["t"](i.color)):e.fog[n]&&(e.fog[n]=s):e.fog=new r["N"](i.color,i.density)):e.fog=null},background({target:e,value:t,engine:n}){so(e,t,n)},environment({target:e,value:t,engine:n}){io(e,t,n)}},delete:ms.delete},create(e,t){const n=new r["jc"];if(so(n,e.background,t),io(n,e.environment,t),e.fog.type){const t=e.fog;"Fog"===t.type?n.fog=new r["M"](t.color,t.near,t.far):"FogExp2"===t.type?n.fog=new r["N"](t.color,t.density):console.warn(`scene processor can not support this type fog:'${e.type}'`)}return ps(n,e,{lookAt:!0,background:!0,environment:!0,fog:!0},t)},dispose:us});class ao extends gr{constructor(){super(),A(this,"MODULE",te.SCENE)}}tr.processor(oo);const co=new r["wc"]({color:"rgb(123, 123, 123)"});var lo=sr({configType:ee.SPRITE,commands:{add:yi.add,set:{lookAt(){},...yi.set,material({target:e,engine:t,value:n}){const s=t.compilerManager.getMaterial(n);s&&s instanceof r["wc"]?e.material=s:e.material=co}},delete:yi.add},create(e,t){const n=new r["vc"],s=t.compilerManager.getMaterial(e.material);return s&&s instanceof r["wc"]?n.material=s:n.material=co,fi(n,e,{geometry:!0,material:!0,lookAt:!0},t)},dispose:Ei});class ho extends di{constructor(){super(),A(this,"MODULE",te.SPRITE)}}tr.processor(lo);class po extends r["Ac"]{constructor(e,t,n,r,s,i,o,a,c,l){super(e,t,n,r,s,i,o,a,c,l)}}const uo={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:e,key:t,value:n}){e[t]=n,e.needsUpdate=!0}},mo=function({target:e,value:t,engine:n}){rs.exec(r=>(e.image=n.compilerManager.textureCompiler.getResource(t,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),e.needsUpdate=!0,e.images!==Ro.replaceImage))};var go=sr({configType:ee.IMAGETEXTURE,commands:{set:{url:mo,$reg:[uo]}},create(e,t){const n=new po;return e.url&&mo({target:n,value:e.url,engine:t}),Dt(e,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose(e){e.dispose()}}),fo=sr({configType:ee.CANVASTEXTURE,commands:{set:{url:mo,$reg:[uo]}},create(e,t){const n=new r["o"](t.compilerManager.textureCompiler.getResource(e.url,HTMLCanvasElement));return mo({target:n,value:e.url,engine:t}),Dt(e,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose(e){e.dispose()}});const Eo=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],yo=function({target:e,index:t,value:n,engine:r}){e.images[t]=r.compilerManager.textureCompiler.getResource(n,Eo),e.needsUpdate=!0};var vo=sr({configType:ee.CUBETEXTURE,commands:{set:{cube:{px({target:e,value:t,engine:n}){yo({target:e,value:t,engine:n,index:0})},nx({target:e,value:t,engine:n}){yo({target:e,value:t,engine:n,index:1})},py({target:e,value:t,engine:n}){yo({target:e,value:t,engine:n,index:2})},ny({target:e,value:t,engine:n}){yo({target:e,value:t,engine:n,index:3})},pz({target:e,value:t,engine:n}){yo({target:e,value:t,engine:n,index:4})},nz({target:e,value:t,engine:n}){yo({target:e,value:t,engine:n,index:5})}}}},create(e,t){const n=new r["x"],s=e.cube,i=t.compilerManager.textureCompiler,o=[i.getResource(s.px,Eo),i.getResource(s.nx,Eo),i.getResource(s.py,Eo),i.getResource(s.ny,Eo),i.getResource(s.pz,Eo),i.getResource(s.nz,Eo)];return n.image=o,Dt(e,n,{type:!0,cube:!0}),n.needsUpdate=!0,n},dispose(e){e.dispose()}});class bo extends r["Ac"]{constructor(e,t,n,s,i,o,a,c,l){super(e,t,n,s,i,o,a,c,l),A(this,"isVideoTexture",!0),this.format=void 0!==a?a:r["bc"],this.minFilter=void 0!==o?o:r["gb"],this.magFilter=void 0!==i?i:r["gb"],this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,t="requestVideoFrameCallback"in e;(t||!1===t&&e.readyState>=e.HAVE_CURRENT_DATA)&&(this.needsUpdate=!0)}}var Mo=sr({configType:ee.VIDEOTEXTURE,commands:{set:{url:mo,$reg:[uo]}},create(e,t){const n=new bo(document.createElement("video"));return e.url&&mo({target:n,value:e.url,engine:t}),Dt(e,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose(e){e.dispose()}});class So{constructor(e){A(this,"canvas"),this.canvas=document.createElement("canvas");const t=window.devicePixelRatio;this.canvas.width=((null==e?void 0:e.width)||512)*t,this.canvas.height=((null==e?void 0:e.height)||512)*t,this.canvas.style.backgroundColor=(null==e?void 0:e.bgColor)||"rgb(255, 255, 255)";const n=this.canvas.getContext("2d");n&&n.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,t=0,n,r){!n&&(n=this.canvas.width),!r&&(r=this.canvas.height);const s=this.canvas.getContext("2d");return s?(s.clearRect(e,t,n,r),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const t=this.canvas.getContext("2d");return t?(e(t),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const t=this.canvas;return t.style.position="fixed",t.style.top=(null==e?void 0:e.top)||"5%",t.style.left=(null==e?void 0:e.left)||"5%",t.style.right=(null==e?void 0:e.right)||"unset",t.style.bottom=(null==e?void 0:e.bottom)||"unset",(null==e?void 0:e.scale)&&(t.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}}class wo extends r["Ac"]{constructor(e){super(),Object.keys(e).forEach(t=>{this[t]=e[t]}),this.copy(e)}}var To=sr({configType:ee.LOADTEXTURE,commands:{set:{url({}){},$reg:[uo]}},create(e,t){let n;const s=t.compilerManager.textureCompiler.getResource(e.url,r["Ac"]);if(s instanceof r["Ac"])n=new wo(s);else{const e=new r["Ac"](s);n=new wo(e)}return Dt(e,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose(e){e.dispose()}});const xo=class extends tr{constructor(){super(),A(this,"MODULE",te.TEXTURE)}getResource(e,t){const n=this.engine.resourceManager.resourceMap;if(!n.has(e))return console.warn("engine resourceManager can not found this url: "+e),xo.replaceImage;const r=n.get(e);if(Array.isArray(t)){for(const e of t)if(r instanceof e)return r;return console.warn("this url mapping resource is not a texture image class: "+e,r),xo.replaceImage}return r instanceof t?r:(console.warn("this url mapping resource is not a texture image class: "+e,r),xo.replaceImage)}};let Ro=xo;A(Ro,"replaceImage",new So({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("暂无图片",0,0)}).getDom()),tr.processor(go),tr.processor(fo),tr.processor(vo),tr.processor(Mo),tr.processor(To);class Oo extends O["a"]{constructor(e=document.createElement("div")){const t=document.createElement("div"),n=50,s=50;t.style.width=n+"px",t.style.height=s+"px",t.appendChild(e),super(t),A(this,"geometry"),A(this,"_width"),A(this,"_height"),this.geometry=new r["Mb"](n,s),this.geometry.computeBoundingBox(),this._width=n,this._height=s}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new r["Mb"](e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=e+"px",this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new r["Mb"](this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=e+"px",this._height=e}}class Co extends Oo{constructor(e=document.createElement("div")){super(e),A(this,"cacheBox",new r["g"]),A(this,"viewWorldMatrix",new r["pb"]),A(this,"mvPosition",new r["Kc"]),A(this,"matrixScale",new r["Kc"]),A(this,"worldScale",new r["Kc"]),A(this,"vA",new r["Kc"]),A(this,"vB",new r["Kc"]),A(this,"vC",new r["Kc"]),A(this,"alignedPosition",new r["Jc"]),A(this,"rotatedPosition",new r["Jc"]),A(this,"intersectPoint",new r["Kc"]),this.type="CSS2DPlane",this.element.classList.add("vis-css2d","vis-css2d-plane");const t=new MutationObserver(()=>{this.matrixScale.set(.1*Math.abs(this.width/100),.1*Math.abs(this.height/100),1)});t.observe(this.element,{attributeFilter:["style"]})}transformVertex(e,t,n){const r=this.alignedPosition,s=this.rotatedPosition,i=0,o=1;r.copy(e).multiply(n),s.x=o*r.x-i*r.y,s.y=i*r.x+o*r.y,e.copy(t),e.x+=s.x,e.y+=s.y,e.applyMatrix4(this.viewWorldMatrix)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),this.viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),this.mvPosition.setFromMatrixPosition(this.modelViewMatrix),this.worldScale.copy(this.matrixScale).multiplyScalar(-this.mvPosition.z),this.transformVertex(this.vA.set(-.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vB.set(.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vC.set(.5,.5,0),this.mvPosition,this.worldScale);let n=e.ray.intersectTriangle(this.vA,this.vB,this.vC,!1,this.intersectPoint);if(null===n&&(this.transformVertex(this.vB.set(-.5,.5,0),this.mvPosition,this.worldScale),n=e.ray.intersectTriangle(this.vA,this.vC,this.vB,!1,this.intersectPoint),null===n))return;const r=e.ray.origin.distanceTo(this.intersectPoint);r<e.near||r>e.far||t.push({distance:r,point:this.intersectPoint.clone(),face:null,object:this})}}const Lo=function(e,t){const n=t.resourceManager.resourceMap;if(!n.has(e))return console.warn("css2D compiler: can not found resource element: "+e),document.createElement("div");const r=n.get(e);return r instanceof HTMLElement?r:(console.warn("css2D compiler can not suport render this resource type.",r.constructor,e),document.createElement("div"))};var Ao=sr({configType:ee.CSS2DPLANE,commands:{add:ms.add,set:{element({target:e,value:t,engine:n}){e.element.innerHTML="",e.element.appendChild(Lo(t,n))},...ms.set},delete:ms.delete},create(e,t){return ps(new Co(Lo(e.element,t)),e,{element:!0},t)},dispose:us});class Io extends gr{constructor(){super(),A(this,"MODULE",te.CSS2D)}}tr.processor(Ao);class Do extends I{constructor(e){super(),A(this,"object3DCompiler",new Vi),A(this,"cameraCompiler",new ys),A(this,"lightCompiler",new hi),A(this,"geometryCompiler",new ei),A(this,"textureCompiler",new Ro),A(this,"materialCompiler",new Fi),A(this,"rendererCompiler",new ro),A(this,"sceneCompiler",new ao),A(this,"controlsCompiler",new Ms),A(this,"spriteCompiler",new ho),A(this,"lineCompiler",new bi),A(this,"meshCompiler",new _i),A(this,"pointsCompiler",new eo),A(this,"groupCompiler",new ni),A(this,"css3DCompiler",new As),A(this,"css2DCompiler",new Io),A(this,"passCompiler",new Zi),A(this,"animationCompiler",new mr),A(this,"compilerMap"),e&&Object.keys(e).forEach(t=>{this[t]=e[t]});const t=new Map;Object.keys(this).forEach(e=>{const n=this[e];n instanceof tr&&t.set(n.MODULE,n)}),this.compilerMap=t}support(e){this.compilerMap.forEach(t=>{t.useEngine(e)});const t=e.dataSupportManager;for(const n of Object.values(te))t[n+"DataSupport"].addCompiler(this[n+"Compiler"]);return this}getObjectSymbol(e){for(const t of this.compilerMap.values()){const n=t.getObjectSymbol(e);if(n)return n}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const n=t.getObjectBySymbol(e);if(n)return n}return null}getObject3D(e){for(const t of this.compilerMap.values())if(t instanceof gr&&t.map.has(e))return t.map.get(e);return null}getGeometry(e){return this.geometryCompiler.map.get(e)||null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const Po=function(e){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const t=new Do;return this.compilerManager=t,this.getObjectSymbol=function(e){return this.compilerManager.getObjectSymbol(e)},this.getObjectBySymbol=function(e){return this.compilerManager.getObjectBySymbol(e)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class jo extends I{constructor(){super(),A(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?M.a.watch(void 0,e):M.a.watch(),this}register(e){const t=this.generateSymbol(e);return this.map.has(t)?(console.warn(`KeyboardManager: shortcutKey already exist: ${t}. desp: ${this.map.get(t).desp}`),this):(M.a.bind(t,e.keydown||null,e.keyup),this.map.set(t,e),this)}update(e){const t=this.generateSymbol(e);return this.map.has(t)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const t=this.generateSymbol(e);if(this.map.has(t)){const e=this.map.get(t);M.a.unbind(t,e.keydown||null,e.keyup),this.map.delete(t)}return this}checkRepeat(e){const t=this.generateSymbol(e);return this.map.has(t)}getDocs(){const e=[];return this.map.forEach(t=>{e.push({shortcutKey:[].concat(t.shortcutKey),desp:t.desp})}),e}}const No=function(e){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const t=new jo;return this.keyboardManager=t,this.completeSet.add(()=>{if(this.transformControls){const e=()=>this.dataSupportManager.controlsDataSupport.getData()[ee.TRNASFORMCONTROLS]||this.transformControls;this.IS_ENGINESUPPORT?t.register({shortcutKey:["shift"],desp:"变换控制器锁定步幅",keyup:t=>{null==t||t.preventDefault();const n=e();n&&(n.snapAllow=!1)},keydown:t=>{null==t||t.preventDefault(),null==t||t.preventRepeat();const n=e();n&&(n.snapAllow=!0)}}):t.register({shortcutKey:["shift"],desp:"变换控制器锁定步幅",keyup:t=>{null==t||t.preventDefault();const n=e();n.translationSnap=null,n.rotationSnap=null,n.scaleSnap=null},keydown:t=>{null==t||t.preventDefault(),null==t||t.preventRepeat();const n=e();n.translationSnap=5,n.rotationSnap=Math.PI/180*10,n.scaleSnap=.1}}),t.register({shortcutKey:["r"],desp:"变换控制器模式：旋转",keyup:t=>{null==t||t.preventDefault();const n=e();n&&(n.mode="rotate")}}).register({shortcutKey:["t"],desp:"变换控制器模式：移动",keyup:t=>{null==t||t.preventDefault();const n=e();n&&(n.mode="translate")}}).register({shortcutKey:["e"],desp:"变换控制器模式：缩放",keyup:t=>{null==t||t.preventDefault();const n=e();n.mode="scale"}}).register({shortcutKey:["x"],desp:"变换控制器切换轴：x",keyup:t=>{null==t||t.preventDefault();const n=e();n.showX=!n.showX}}).register({shortcutKey:["y"],desp:"变换控制器切换轴：y",keyup:t=>{if(null==t||t.preventDefault(),null==t?void 0:t.ctrlKey)return;const n=e();n.showY=!n.showY}}).register({shortcutKey:["z"],desp:"变换控制器切换轴：z",keyup:t=>{if(null==t||t.preventDefault(),null==t?void 0:t.ctrlKey)return;const n=e();n.showZ=!n.showZ}}).register({shortcutKey:["space"],desp:"变换控制器切换变换空间",keyup:t=>{null==t||t.preventDefault();const n=e();n.space="local"===n.space?"world":"local"}})}}),!0},Uo=function(e={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const t=new r["e"](e.length||500);return t.matrixAutoUpdate=!1,t.raycast=()=>{},this.scene.add(t),this.setAxesHelper=function(e){return e.show?this.scene.add(t):this.scene.remove(t),this},this.addEventListener("setScene",e=>{e.scene.add(t)}),!0},Go=function(e={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const t=new r["P"](e.range||500,e.spacing||50,e.axesColor||"rgb(130, 130, 130)",e.cellColor||"rgb(70, 70, 70)");if(1!==e.opacity){const n=t.material;n.transparent=!0,n.opacity=e.opacity||.5,n.needsUpdate=!0}return t.matrixAutoUpdate=!1,t.raycast=()=>{},this.scene.add(t),this.setGridHelper=function(e){return e.show?this.scene.add(t):this.scene.remove(t),this},this.addEventListener("setScene",e=>{e.scene.add(t)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const n=e.viewpoint;n===N.DEFAULT||n===N.TOP||n===N.BOTTOM?t.rotation.set(0,0,0):n===N.RIGHT||n===N.LEFT?t.rotation.set(0,0,Math.PI/2):(n===N.FRONT||n===N.BACK)&&t.rotation.set(Math.PI/2,0,0),t.updateMatrix(),t.updateMatrixWorld()})}),!0};const Bo=function(e={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!e.overrideColor&&(e.overrideColor="rgb(250, 250, 250)"),!e.defaultAmbientLightSetting&&(e.defaultAmbientLightSetting={}),!e.defaultAmbientLightSetting.color&&(e.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!e.defaultAmbientLightSetting.intensity&&(e.defaultAmbientLightSetting.intensity=.5);const t=new r["c"](e.defaultAmbientLightSetting.color,e.defaultAmbientLightSetting.intensity);t.matrixAutoUpdate=!1,!e.defaultDirectionalLightSetting&&(e.defaultDirectionalLightSetting={}),!e.defaultDirectionalLightSetting.color&&(e.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!e.defaultDirectionalLightSetting.intensity&&(e.defaultDirectionalLightSetting.intensity=.5),!e.defaultDirectionalLightSetting.position&&(e.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const n=new r["F"](e.defaultDirectionalLightSetting.color,e.defaultDirectionalLightSetting.intensity);n.castShadow=!1,n.position.set(e.defaultDirectionalLightSetting.position.x,e.defaultDirectionalLightSetting.position.y,e.defaultDirectionalLightSetting.position.z),n.updateMatrix(),n.updateMatrixWorld(),n.matrixAutoUpdate=!1,!e.mode&&(e.mode="env"),this.displayMode=e.mode;const s=new r["sb"]({color:e.overrideColor}),i=new r["bb"]({color:e.overrideColor}),o=new r["Qb"]({color:e.overrideColor,size:5,sizeAttenuation:!1}),a=new r["wc"]({color:e.overrideColor}),c=new WeakMap,l=new Set,h=new Set,d=new Set,p=new Set,u=new Set;let m,g;const f={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",e=>{const m=this.displayMode,g=e.objects;for(const E of g)if(!f[E.type])if(E instanceof r["qb"]&&"Mesh"===E.type)h.add(E),"geometry"===m&&(c.set(E,E.material),E.material=s);else if(E instanceof r["ab"]&&E.type.includes("Line"))d.add(E),"geometry"===m&&(c.set(E,E.material),E.material=i);else if(E instanceof r["Z"]&&E.type.includes("Light")){if(E===t||E===n)continue;l.has(E)||l.add(E),"env"!==m&&"light"!==m&&this.scene.remove(E)}else E instanceof r["Pb"]&&"Points"===E.type?(p.add(E),"geometry"===m&&(c.set(E,E.material),E.material=o)):E instanceof r["vc"]&&"Sprite"===E.type&&(u.add(E),"geometry"===m&&(c.set(E,E.material),E.material=a))}),this.scene.addEventListener("afterRemove",e=>{const s=e.objects;for(const i of s)if(!f[i.type])if(i instanceof r["qb"]&&"Mesh"===i.type)h.delete(i),c.has(i)&&c.delete(i);else if(i instanceof r["ab"]&&i.type.includes("Line"))d.delete(i),c.has(i)&&c.delete(i);else if(i instanceof r["Z"]&&i.type.includes("Light")){if(i===t||i===n)continue;l.delete(i)}else i instanceof r["Pb"]&&"Points"===i.type?(p.delete(i),c.has(i)&&c.delete(i)):i instanceof r["vc"]&&"Sprite"===i.type&&(u.delete(i),c.has(i)&&c.delete(i))});const E=()=>{for(const e of h)e.material!==s&&(c.set(e,e.material),e.material=s);for(const e of d)e.material!==i&&(c.set(e,e.material),e.material=i);for(const e of p)e.material!==o&&(c.set(e,e.material),e.material=o);for(const e of u)e.material!==a&&(c.set(e,e.material),e.material=a)},y=()=>{h.forEach(e=>{c.has(e)&&(e.material=c.get(e),c.delete(e))}),d.forEach(e=>{c.has(e)&&(e.material=c.get(e),c.delete(e))}),p.forEach(e=>{c.has(e)&&(e.material=c.get(e),c.delete(e))}),u.forEach(e=>{c.has(e)&&(e.material=c.get(e),c.delete(e))})},v=()=>{l.forEach(e=>{e.visible=!1}),this.scene.add(t),this.scene.add(n)},b=()=>{l.forEach(e=>{e.visible=!0}),this.scene.remove(t),this.scene.remove(n)},M=()=>{this.scene.background instanceof r["Ac"]&&(m=this.scene.background,this.scene.background=null),this.scene.environment instanceof r["Ac"]&&(g=this.scene.environment,this.scene.environment=null)},S=()=>{m&&(this.scene.background=m,m=void 0),g&&(this.scene.environment=g,g=void 0)};return this.setDisplayMode=function(e){return this.displayMode=e||"env","geometry"===e?(E(),M(),v()):"material"===e?(y(),M(),v()):"light"===e?(y(),M(),b()):"env"===e?(y(),S(),b()):console.warn("displayMode plugin can not set this mode: "+e),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(n)}),!0},Ho=()=>new r["bb"]({color:"rgb(255, 255, 255)"});class zo extends r["eb"]{constructor(e){super(),A(this,"shape"),A(this,"target"),A(this,"type","CameraHelper"),A(this,"cachaData");const t=new r["k"],n=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new r["K"](n,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const s=new r["n"](e);s.matrix=new r["pb"],s.matrixAutoUpdate=!0,s.raycast=()=>{},this.add(s),this.shape=s,this.geometry=t,this.material=Ho(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof r["Lb"]?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof r["Ib"]?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let t=!1;const n=this.cachaData;Object.keys(n).forEach(r=>{n[r]!==e[r]&&(n[r]=e[r],t=!0)}),t&&this.shape.update()}}raycast(e,t){const n=this.matrixWorld,r=this.geometry.boundingBox.clone();if(r.applyMatrix4(n),e.ray.intersectsBox(r)){const n=this.target;t.push({distance:e.ray.origin.distanceTo(n.position),object:n,point:n.position})}}}class ko extends r["eb"]{constructor(e){super(),A(this,"sphere"),A(this,"target"),A(this,"shape"),A(this,"type","VisDirectionalLightHelper"),A(this,"cacheColor"),A(this,"cacheVector3"),this.geometry=new r["k"];const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new r["K"](t,3)),this.material=Ho(),this.geometry.boundingSphere;const n=(new r["t"]).copy(e.color).multiplyScalar(e.intensity),s=new r["Mb"](20,20);s.dispose();const i=new r["eb"](new r["H"](s),new r["bb"]({color:n}));i.raycast=()=>{},this.shape=i,this.target=e,this.sphere=new r["qc"](new r["Kc"](0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new r["Kc"],this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const e=this.target,t=this.shape;e.color.getHex()!==this.cacheColor&&(t.material.color.copy(e.color).multiplyScalar(e.intensity),this.cacheColor=e.color.getHex()),t.lookAt(e.target.position)}}raycast(e,t){const n=this.target,r=n.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(r),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(n.position),object:n,point:n.position})}}class Fo extends r["eb"]{constructor(e){super(),A(this,"sphere"),A(this,"target"),A(this,"shape"),A(this,"type","VisPointLightHelper"),A(this,"cacheColor"),A(this,"cacheDistance"),A(this,"cacheVector3"),this.geometry=new r["k"];const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new r["K"](t,3)),this.material=Ho(),this.geometry.boundingSphere;const n=(new r["t"]).copy(e.color).multiplyScalar(e.intensity),s=new r["qb"](new r["Fb"](e.distance,0),new r["rb"]({color:n,wireframe:!0}));s.raycast=()=>{},s.matrixAutoUpdate=!1,this.shape=s,this.target=e,this.sphere=new r["qc"](new r["Kc"](0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new r["Kc"],this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const e=this.target,t=this.shape;e.distance!==this.cacheDistance&&(t.geometry.dispose(),t.geometry=new r["Fb"](e.distance,0),this.cacheDistance=e.distance),e.color.getHex()!==this.cacheColor&&(t.material.color.copy(e.color).multiplyScalar(e.intensity),this.cacheColor=e.color.getHex())}}raycast(e,t){const n=this.target,r=n.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(r),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(n.position),object:n,point:n.position})}}class Yo extends r["eb"]{constructor(e){super(),A(this,"sphere"),A(this,"target"),A(this,"shape"),A(this,"type","VisSpotLightHelper"),A(this,"cacheVector3"),A(this,"cacheColor"),A(this,"cacheAngle"),A(this,"cacheDistance"),this.geometry=new r["k"];const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new r["K"](t,3)),this.material=Ho(),this.geometry.boundingSphere;const n=new r["k"],s=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,l=1,h=32;r<h;r++,l++){const e=r/h*Math.PI*2,t=l/h*Math.PI*2;s.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new r["K"](s,3));const i=Ho(),o=new r["eb"](n,i);o.material.color.copy(e.color).multiplyScalar(e.intensity);const a=e.distance?e.distance:1e3,c=a*Math.tan(e.angle);o.scale.set(c,c,a),o.raycast=()=>{},this.add(o),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=o,this.sphere=new r["qc"](new r["Kc"](0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new r["Kc"],this.onBeforeRender=()=>{const e=this.target,t=this.shape;let n=!1;if(e.distance!==this.cacheDistance&&(this.cacheDistance=e.distance,t.scale.z=e.distance,n=!0),e.angle!==this.cacheAngle&&(this.cacheAngle=e.angle,n=!0),n){const n=e.distance*Math.tan(e.angle);t.scale.set(n,n,e.distance)}e.color.getHex()!==this.cacheColor&&(t.material.color.copy(e.color).multiplyScalar(e.intensity),this.cacheColor=e.color.getHex()),t.lookAt(e.target.position)}}raycast(e,t){const n=this.target,r=n.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(r),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(n.position),object:n,point:n.position})}}const _o="\n\n#include <common>\n\nvoid main() {\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n  bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n  if ( isPerspective ) scale *= - mvPosition.z;\n\n\tvec2 alignedPosition = position.xy * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( 0.0 ) * alignedPosition.x - sin( 0.0 ) * alignedPosition.y;\n\trotatedPosition.y = sin( 0.0 ) * alignedPosition.x + cos( 0.0 ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n}\n\n",Wo="\n\nuniform vec3 color;\n\nvoid main() {\n  gl_FragColor = vec4(color, 1.0);\n}\n";class Vo extends r["kc"]{constructor(){super(),this.vertexShader=_o,this.fragmentShader=Wo,this.uniforms={color:{value:new r["t"]("white")}}}}class Ko extends r["eb"]{constructor(e){super(),A(this,"target"),A(this,"type","VisCSS2DPlaneHelper"),A(this,"observer"),this.geometry=new r["H"](new r["Mb"](1,1)),this.geometry.computeBoundingBox(),this.material=new Vo,this.scale.copy(e.matrixScale),this.position.set(e.position.x,e.position.y,e.position.z),this.target=e;const t=new MutationObserver(()=>{this.scale.copy(e.matrixScale)});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t,this.onBeforeRender=()=>{this.position.set(this.target.position.x,this.target.position.y,this.target.position.z)},this.raycast=()=>{}}dispose(){this.observer.disconnect()}}class Qo extends r["eb"]{constructor(e){super(),A(this,"target"),A(this,"type","VisCSS3DHelper");const t=e.element,n=t.getBoundingClientRect(),s=n.width,i=n.height;this.geometry=new r["H"](new r["Mb"](s,i)),this.geometry.computeBoundingBox(),this.material=Ho(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,t){const n=this.target,r=n.matrixWorld,s=this.geometry.boundingBox.clone();s.applyMatrix4(r),e.ray.intersectsBox(s)&&t.push({distance:e.ray.origin.distanceTo(n.position),object:n,point:n.position})}}class $o extends r["eb"]{constructor(e){super(),A(this,"target"),A(this,"type","VisCSS3DPlaneHelper"),A(this,"observer"),this.geometry=new r["H"](new r["Mb"](e.width,e.height)),this.geometry.computeBoundingBox(),this.material=Ho(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const t=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new r["H"](new r["Mb"](e.width,e.height)),this.geometry.computeBoundingBox()});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t,this.raycast=()=>{},this.updateMatrixWorld=()=>{}}dispose(){this.observer.disconnect()}}const Jo="\nuniform float rotation2D;\n\n#include <common>\n\nvoid main() {\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\tvec2 alignedPosition = position.xy * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation2D ) * alignedPosition.x - sin( rotation2D ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation2D ) * alignedPosition.x + cos( rotation2D ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n}\n\n",Xo="\n\nuniform vec3 color;\n\nvoid main() {\n  gl_FragColor = vec4(color, 1.0);\n}\n";class Zo extends r["kc"]{constructor(){super(),this.vertexShader=Jo,this.fragmentShader=Xo,this.uniforms={color:{value:new r["t"]("white")},rotation2D:{value:0}}}}class qo extends r["eb"]{constructor(e){super(),A(this,"target"),A(this,"type","VisCSS3DSpriteHelper"),A(this,"observer"),this.geometry=new r["H"](new r["Mb"](1,1)),this.geometry.computeBoundingBox(),this.material=new Zo,this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const t=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new r["H"](new r["Mb"](e.width,e.height)),this.geometry.computeBoundingBox()});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t,this.onBeforeRender=()=>{this.material.uniforms.rotation2D.value=this.target.rotation2D},this.raycast=()=>{},this.updateMatrixWorld=()=>{}}dispose(){this.observer.disconnect()}}const ea=class extends r["vc"]{constructor(e){super(),A(this,"target"),A(this,"type","VisGroupHelper"),this.target=e,this.geometry.computeBoundingBox(),this.material=new r["wc"]({map:ea.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const t=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=e=>{const n=this.position,r=this.target.position;n.x=r.x,n.y=r.y,n.z=r.z,t(e)}}raycast(e,t){const n=this.matrixWorld,r=this.geometry.boundingBox.clone();if(r.applyMatrix4(n),e.ray.intersectsBox(r)){const n=this.target;t.push({distance:e.ray.origin.distanceTo(n.position),object:n,point:n.position})}}};let ta=ea;A(ta,"colorTexture",new r["o"](new So({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const na=class extends r["Pb"]{constructor(e){super(),A(this,"target"),A(this,"cachaGeometryUUid"),A(this,"type","VisLineHelper"),this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new r["Qb"]({color:"rgb(255, 255, 255)",alphaMap:na.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const e=this.target;e.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=e.geometry.clone(),this.cachaGeometryUUid=e.geometry.uuid)}}};let ra=na;A(ra,"alphaTexture",new r["o"](new So({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,2*Math.PI),e.fill(),e.closePath()}).getDom()));class sa extends r["eb"]{constructor(e){super(),A(this,"target"),A(this,"type","VisMeshHelper"),A(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new r["H"](e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=Ho(),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.updateMatrixWorld=()=>{},this.raycast=()=>{},this.onBeforeRender=()=>{const e=this.target;e.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new r["H"](e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid)}}}const ia=class extends r["Pb"]{constructor(e){super(),A(this,"target"),A(this,"type","VisPointsHelper"),this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new r["Qb"]({color:"rgb(255, 255, 255)",alphaMap:ia.alphaTexture,transparent:!0});const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof r["Qb"]&&(this.material.size=t.size,this.material.sizeAttenuation=t.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let oa=ia;A(oa,"alphaTexture",new r["o"](new So({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const aa="\n\nuniform float rotation;\nuniform vec2 center;\nuniform bool sizeAttenuation;\n\n#include <common>\n\nvoid main() {\n  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\tif (!sizeAttenuation) {\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n  }\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n}\n\n",ca="\n\nuniform vec3 color;\n\nvoid main() {\n  gl_FragColor = vec4(color, 1.0);\n}\n";class la extends r["kc"]{constructor(){super(),this.vertexShader=aa,this.fragmentShader=ca,this.uniforms={color:{value:new r["t"]("white")},center:{value:new r["Jc"](.5,.5)},rotation:{value:0},sizeAttenuation:{value:!1}}}}class ha extends r["eb"]{constructor(e){super(),A(this,"target"),A(this,"type","VisSpriteHelper"),this.geometry=new r["H"](new r["Mb"](1,1)),this.geometry.computeBoundingBox(),this.material=new la,this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.target=e,this.onBeforeRender=()=>{this.material.uniforms.rotation.value=this.target.material.rotation,this.material.uniforms.sizeAttenuation.value=this.target.material.sizeAttenuation},this.raycast=()=>{}}}class da extends I{constructor(e={}){super(),A(this,"helperGenerator",{[ee.POINTLIGHT]:Fo,[ee.SPOTLIGHT]:Yo,[ee.DIRECTIONALLIGHT]:ko,[ee.PERSPECTIVECAMERA]:zo,[ee.ORTHOGRAPHICCAMERA]:zo,[ee.MESH]:sa,[ee.GROUP]:ta,[ee.SPRITE]:ha,[ee.POINTS]:oa,[ee.LINE]:ra,[ee.CSS3DOBJECT]:Qo,[ee.CSS3DPLANE]:$o,[ee.CSS3DSPRITE]:qo,[ee.CSS2DPLANE]:Ko}),A(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0}),A(this,"objectFilter",new Set),A(this,"objectHelperMap",new Map),e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const t of e)this.objectFilter.add(t);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const t=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,t),t}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const t=this.objectHelperMap.get(e);return t.geometry&&t.geometry.dispose(),t.material&&(t.material instanceof r["mb"]?t.material.dispose():t.material.forEach(e=>{e.dispose()})),this.objectHelperMap.delete(e),t}}const pa=function(e={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;void 0===e.interact&&(e.interact=!0),e.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),e.interact=!1));const t=new da,n=new Map,s=new Map,i=new Map,o=t.objectHelperMap;this.objectHelperManager=t,!e.activeColor&&(e.activeColor="rgb(230, 20, 240)"),!e.hoverColor&&(e.hoverColor="rgb(255, 158, 240)"),!e.defaultColor&&(e.defaultColor="rgb(255, 255, 255)"),!e.selectedColor&&(e.selectedColor=e.activeColor);const a=new r["t"](e.defaultColor).getHex(),c=new r["t"](e.activeColor).getHex(),l=new r["t"](e.hoverColor).getHex(),h=new r["t"](e.selectedColor).getHex(),d=new WeakSet,p=(e,t)=>{e.material.color?e.material.color.setHex(a):e.material instanceof r["kc"]&&e.material.uniforms.color.value.setHex(t)},u=r=>{const o=r.objects;for(const h of o){const r=t.addObjectHelper(h);if(r&&(p(r,a),this.scene.add(r),e.interact)){const e=()=>{var e;(null==(e=this.transformControls)?void 0:e.dragging)||this.selectionBox&&this.selectionBox.has(h)||p(r,l)},t=()=>{var e;(null==(e=this.transformControls)?void 0:e.dragging)||this.selectionBox&&this.selectionBox.has(h)||p(r,a)},o=()=>{var e;(null==(e=this.transformControls)?void 0:e.dragging)||this.selectionBox&&this.selectionBox.has(h)||p(r,c)};h.addEventListener("pointerenter",e),h.addEventListener("pointerleave",t),h.addEventListener("click",o),n.set(h,e),s.set(h,t),i.set(h,o)}}},m=r=>{const o=r.objects;for(const a of o){const r=t.disposeObjectHelper(a);r&&(this.scene.remove(r),e.interact&&(a.removeEventListener("pointerenter",n.get(a)),a.removeEventListener("pointerleave",s.get(a)),a.removeEventListener("click",i.get(a)),n.delete(a),s.delete(a),i.delete(a)))}},g=e=>{d.has(e)||(e.traverse(n=>{const r=t.addObjectHelper(n);r&&e.add(r)}),d.add(e))};this.scene.addEventListener("afterAdd",u),this.scene.addEventListener("afterRemove",m),this.setObjectHelper=function(e){return e.show?this.scene.traverse(e=>{o.has(e)&&this.scene.add(o.get(e))}):this.scene.traverse(e=>{o.has(e)&&this.scene.remove(o.get(e))}),this},this.addEventListener("setScene",e=>{const t=e.scene;!d.has(t)&&g(t),t.hasEventListener("afterAdd",u)||t.addEventListener("afterAdd",u),t.hasEventListener("afterRemove",m)||t.addEventListener("afterRemove",m)});const f=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",e=>{f.forEach(e=>{p(e,a)}),f.clear();for(const t of e.objects)if(o.has(t)){const e=o.get(t);p(e,h),f.add(e)}})}),!0},ua=function(e={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const t=()=>{const e=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(t=>{const n=this.compilerManager.getObjectSymbol(t);n?e.push(n):console.warn("selection plugin can not font vid in compilerManager.",t)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:e})};return this.setSelectionBox=function(e){this.selectionBox.clear();for(const t of e.objects)this.selectionBox.add(t);return t(),this},this.eventManager.addEventListener("click",e=>{var n,r,s;if(this.transing)return void(this.transing=!1);const i=e.intersections;if(e.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const t of i)e.ctrlKey&&(null==(n=this.selectionBox)?void 0:n.has(t.object))?this.selectionBox.delete(t.object):this.selectionBox.add(t.object);else if(i.length){const t=i[0].object;if(e.ctrlKey&&(null==(r=this.selectionBox)?void 0:r.has(t)))return void this.selectionBox.delete(t);null==(s=this.selectionBox)||s.add(t)}t()}),!0},ma=function(e={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new y["b"];const t=this.css3DRenderer.domElement;if(t.classList.add("vis-css3D"),t.style.position="absolute",t.style.top="0",t.style.left="0",this.addEventListener("setDom",e=>{e.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",e=>{this.css3DRenderer.setSize(e.width,e.height)}),this.addEventListener("setScene",e=>{const t=e.oldScene;t.traverse(e=>{e instanceof y["a"]&&(e.element.style.display="none")})}),this.renderManager)this.renderManager.addEventListener("render",e=>{this.css3DRenderer.render(this.scene,this.camera)});else{const e=this.render.bind(this);this.render=function(){return e(),this.css3DRenderer.render(this.scene,this.camera),this}}return!0},ga=function(e={}){if(this.css2DRenderer)return console.warn("this has installed css2DRenderer plugin."),!1;this.css2DRenderer=new O["b"];const t=this.css2DRenderer.domElement;if(t.classList.add("vis-css2D"),t.style.position="absolute",t.style.top="0",t.style.left="0",this.addEventListener("setDom",e=>{e.dom.appendChild(this.css2DRenderer.domElement)}),this.addEventListener("setSize",e=>{this.css2DRenderer.setSize(e.width,e.height)}),this.addEventListener("setScene",e=>{const t=e.oldScene;t.traverse(e=>{e instanceof O["a"]&&(e.element.style.display="none")})}),this.renderManager)this.renderManager.addEventListener("render",e=>{this.css2DRenderer.render(this.scene,this.camera)});else{const e=this.render.bind(this);this.render=function(){return e(),this.css2DRenderer.render(this.scene,this.camera),this}}return!0};var fa=(e=>(e["WEBGLRENDERER"]="WebGLRenderer",e["CSS3DRENDERER"]="CSS3DRenderer",e["CSS2DRENDERER"]="CSS2DRenderer",e["SCENE"]="Scene",e["MODELINGSCENE"]="ModelingScene",e["RENDERMANAGER"]="RenderManager",e["ORBITCONTROLS"]="OrbitControls",e["STATS"]="Stats",e["EFFECTCOMPOSER"]="EffectComposer",e["POINTERMANAGER"]="PointerManager",e["EVENTMANAGER"]="EventManager",e["TRANSFORMCONTROLS"]="TransformControls",e["LOADERMANAGER"]="LoaderManager",e["RESOURCEMANAGER"]="ResourceManager",e["DATASUPPORTMANAGER"]="DataSupportManager",e["COMPILERMANAGER"]="CompilerManager",e["KEYBOARDMANAGER"]="KeyboardManager",e["AXESHELPER"]="AxesHelper",e["GRIDHELPER"]="GridHelper",e["VIEWPOINT"]="Viewpoint",e["DISPLAYMODE"]="DisplayMode",e["OBJECTHELPER"]="ObjectHelper",e["SELECTION"]="Selection",e))(fa||{});const Ea=class extends I{constructor(){super(),A(this,"completeSet"),A(this,"camera",new r["Lb"]),A(this,"scene",new r["jc"]),A(this,"IS_ENGINESUPPORT",!1),A(this,"dom"),A(this,"webGLRenderer"),A(this,"css3DRenderer"),A(this,"css2DRenderer"),A(this,"orbitControls"),A(this,"transformControls"),A(this,"effectComposer"),A(this,"renderManager"),A(this,"pointerManager"),A(this,"eventManager"),A(this,"loaderManager"),A(this,"resourceManager"),A(this,"dataSupportManager"),A(this,"compilerManager"),A(this,"keyboardManager"),A(this,"objectHelperManager"),A(this,"transing"),A(this,"stats"),A(this,"displayMode"),A(this,"selectionBox"),A(this,"getScreenshot"),A(this,"setStats"),A(this,"setTransformControls"),A(this,"setViewpoint"),A(this,"setDisplayMode"),A(this,"setAxesHelper"),A(this,"setGridHelper"),A(this,"setObjectHelper"),A(this,"setSelectionBox"),A(this,"loadResources"),A(this,"loadResourcesAsync"),A(this,"registerResources"),A(this,"toJSON"),A(this,"exportConfig"),A(this,"applyConfig"),A(this,"getConfigBySymbol"),A(this,"removeConfigBySymbol"),A(this,"getObjectSymbol"),A(this,"getObjectBySymbol"),A(this,"play"),A(this,"stop"),A(this,"render"),this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{void 0===this[e]&&delete this[e]})}install(e,t){return Ea.pluginHandler.has(e)?Ea.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var n,r;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=(null==(n=this.dom)?void 0:n.offsetWidth)||window.innerWidth),!t&&(t=(null==(r=this.dom)?void 0:r.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){if("object"===typeof e&&e instanceof r["m"])this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})});else if(this.IS_ENGINESUPPORT){const n=this.compilerManager.getObjectBySymbol(e);n?(this.camera=n,this.dispatchEvent({type:"setCamera",camera:n,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})})):console.warn("can not found camera in compilerManager: "+e)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if("object"===typeof e&&e instanceof r["jc"])this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const t=this.compilerManager.getObjectBySymbol(e);t?(this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t):console.warn("can not found scene in compilerManager: "+e)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let ya=Ea;A(ya,"pluginHandler",new Map),A(ya,"register",(function(e,t){return Ea.pluginHandler&&Ea.pluginHandler.set(e,t),Ea})),A(ya,"dispose",(function(){Ea.pluginHandler=void 0})),ya.register("WebGLRenderer",$),ya.register("CSS3DRenderer",ma),ya.register("CSS2DRenderer",ga),ya.register("EffectComposer",z),ya.register("RenderManager",P),ya.register("PointerManager",F),ya.register("EventManager",W),ya.register("LoaderManager",q),ya.register("ResourceManager",_t),ya.register("DataSupportManager",qn),ya.register("CompilerManager",Po),ya.register("KeyboardManager",No),ya.register("OrbitControls",G),ya.register("TransformControls",Q),ya.register("AxesHelper",Uo),ya.register("GridHelper",Go),ya.register("ObjectHelper",pa),ya.register("DisplayMode",Bo),ya.register("Viewpoint",U),ya.register("Stats",H),ya.register("Selection",ua);const va=function(e,t,n={strict:!0,warn:!0}){if(!Tt[e])return console.error(`type: ${e} can not be found in configList.`),{vid:"",type:e};const r=(t,s)=>{for(const i in s)void 0!==t[i]?"object"!==typeof s[i]||null===s[i]||Array.isArray(s[i])?t[i]=s[i]:(null===t[i]&&(t[i]={...s[i]}),r(t[i],s[i])):(!n.strict&&(t[i]=s[i]),n.strict&&n.warn&&console.warn(`'${e}' config can not set key: ${i}`))};let s=Tt[e]();if([ee.SHADERMATERIAL].includes(e)){const e=Bi.generateConfig((null==t?void 0:t.shader)||"defaultShader"),i=n.strict;n.strict=!1,r(s,e),n.strict=i}[ee.SCRIPTANIMATION,ee.KEYFRAMEANIMATION].includes(e)&&(n.strict=!1),""===s.vid&&(s.vid=Object(g["a"])()),t&&r(s,t),n.handler&&(s=n.handler(s));const i=rn(s);if(va.autoInject&&va.injectEngine){const e=va.injectEngine;if(e.applyConfig(i),va.injectScene&&ie(s.type)&&s.type!==ee.SCENE){let t=null;"boolean"===typeof va.injectScene?t=e.getObjectConfig(e.scene):"string"===typeof va.injectScene&&(t=e.getConfigBySymbol(va.injectScene)),t?t.children.push(s.vid):console.warn("current engine scene can not found it config",e,e.scene)}return i}return i};va.autoInject=!0,va.injectScene=!1,va.injectEngine=null;const ba=new r["Ob"]("rgb(255, 255, 255)",.5,200,1);ba.position.set(-30,5,20),ba.castShadow=!0;const Ma=new r["qb"](new r["h"](80,2,80),new r["vb"]({color:"rgb(255, 255, 255)"}));Ma.position.set(0,-11,0),Ma.receiveShadow=!0,Ma.castShadow=!0;const Sa=class{constructor(e){A(this,"material"),A(this,"dom"),A(this,"renderer"),A(this,"scene"),A(this,"camera"),A(this,"object");const t=new r["Oc"]({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=r["Kb"];const n=new r["jc"],s=new r["Lb"](45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new r["Kc"](0,0,0)),n.add(Sa.ambientLight),n.add(Sa.pointLight),n.add(Sa.plane),this.scene=n,this.renderer=t,this.camera=s,this.object=new r["Eb"],(null==e?void 0:e.material)&&this.setMaterial(e.material),(null==e?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new r["qb"](Sa.geometry,e);else if(e.type.includes("Line"))this.object=new r["ab"](Sa.geometry,e);else if(e.type.includes("Ponits"))this.object=new r["Pb"](Sa.geometry,e);else{if(!e.type.includes("Sprite"))return console.warn(`material displayer can not support this type material: '${e.type}'`),this;this.object=new r["vc"](e)}return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const e=this.dom;this.camera.aspect=e.offsetWidth/e.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.offsetWidth,e.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let wa=Sa;A(wa,"ambientLight",new r["c"]("rgb(255, 255, 255)",.7)),A(wa,"pointLight",ba),A(wa,"geometry",new r["rc"](10,12,12)),A(wa,"plane",Ma),A(wa,"dispose",()=>{Sa.geometry.dispose(),Sa.plane.geometry.dispose()});const Ta=class{constructor(e){A(this,"dom"),A(this,"texture"),A(this,"renderer"),A(this,"scene"),A(this,"camera");const t=new r["Oc"]({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=r["Kb"];const n=new r["jc"],s=new r["Lb"](45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new r["Kc"](0,0,0)),n.add(Ta.ambientLight),this.scene=n,this.renderer=t,this.camera=s,(null==e?void 0:e.texture)&&this.setTexture(e.texture),(null==e?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const e=this.dom;this.camera.aspect=e.offsetWidth/e.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.offsetWidth,e.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let xa=Ta;A(xa,"ambientLight",new r["c"]("rgb(255, 255, 255)",1));class Ra extends ya{constructor(e={},t={}){super(),A(this,"IS_ENGINESUPPORT",!0),this.install(fa.LOADERMANAGER).install(fa.RESOURCEMANAGER,{resources:t}).install(fa.POINTERMANAGER).install(fa.EVENTMANAGER).install(fa.RENDERMANAGER).install(fa.DATASUPPORTMANAGER,e).install(fa.COMPILERMANAGER)}loadLifeCycle(e){const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)}removeLifeCycle(e){const t=this.dataSupportManager,n=e[te.TEXTURE]||[],r=e[te.MATERIAL]||[],s=e.assets||[];delete e.texture,delete e.material,delete e.assets,t.remove(e),t.remove({[te.MATERIAL]:r}),t.remove({[te.TEXTURE]:n});const i=this.resourceManager,o=this.loaderManager;s.forEach(e=>{i.remove(e),o.remove(e)})}loadConfig(e,t){const n=this.renderManager.hasRendering();if(n&&this.renderManager.stop(),e.assets&&e.assets.length){const r=s=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",r),t&&t(s),n?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",r),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),n?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((t,n)=>{const r=this.renderManager.hasRendering();if(r&&this.renderManager.stop(),e.assets&&e.assets.length){const n=s=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",n),r?this.renderManager.play():this.renderManager.render(),t(s)};this.resourceManager.addEventListener("mapped",n),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),r?this.renderManager.play():this.renderManager.render(),t(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}use(e){e.init(this)}}class Oa extends Ra{constructor(e){super(e),this.install(fa.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(fa.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(fa.ORBITCONTROLS).complete()}}const Ca=(e,t={})=>{let n=JSON.stringify(e,$t.stringify);const r={},s=Object.keys(e).filter(e=>"assets"!==e);for(const o of s)for(const s of e[o]){const e=s.vid,i=Object(g["a"])();n=n.replace(new RegExp(e,"g"),i),t.detail&&(r[e]=i)}const i=JSON.parse(n,$t.parse);if(t.fillName)if("function"===typeof t.fillName)for(const o of s)for(const e of i[o])e.name||(e.name=t.fillName(e));else for(const o of s)for(const e of i[o])e.name||(e.name=`${e.type}-${e.vid.slice(-2)}`);return t.detail?{config:i,detail:r}:i},La=(e,t,n={clone:!0,assets:!1})=>{const r=n.clone?$t.clone(e):e,s=n.assets?Object.keys(r):Object.keys(r).filter(e=>"assets"!==e);for(const i of s){const e=r[i];e.forEach((e,n,r)=>{r[n]=t(e)})}return r},Aa=function(e){const t={};for(const n of Object.keys(e))for(const r of e[n])t[r.name]=r;return t};var Ia={clone:Ca,handler:La,planish:Aa};const Da=class{constructor(e){A(this,"token",Symbol("VIS.RENDER.WATCHER")),A(this,"target",{}),A(this,"path",""),A(this,"dep",{}),A(this,"ob"),A(this,"run"),this.run=e,Da.map.set(this.token,this)}init(e,t,n){this.target=t,this.path=e,this.ob=n}notify(e){this.dep[e]&&this.update()}update(){const e=this.path.split("."),t=e.pop();let n=this.target;for(const s of e)n=n[s];const r=this.ob.subscribe(e=>{"get"===e.operate&&(this.dep[e.path]=!0)});n[t]=this.run(),r.unsubscribe()}};let Pa=Da;A(Pa,"map",new Map);class ja extends E["a"]{constructor(){super(),A(this,"subscriptions",[]),A(this,"watchers",[])}watch(e){const t=sn(e);if(!t)return void console.error("Observer: can not found observable",e);for(const r in e)if(Pt(e[r])){const n=sn(e[r]);if(!n)continue;this.subscriptions.push(n.subscribe(e=>{t.next({operate:e.operate,path:Nt(r,e.path),key:e.key,value:e.value})}))}this.subscriptions.push(t.subscribe(e=>{this.next(e)})),this.subscriptions.push(this.subscribe(e=>{if("get"!==e.operate)for(const t of this.watchers)t.notify(e.path)}));const n=(r,s="")=>{for(const i in r){const o=Nt(s,i);if("symbol"===typeof r[i]){const t=Pa.map.get(r[i]);if(!t)continue;t.init(o,e,this),this.watchers.push(t)}else Pt(r[i])&&!t.isIgnore(o)&&n(r[i],o)}};n(e);for(const r of this.watchers)r.update()}dispose(){for(const e of this.subscriptions)e.unsubscribe()}}const Na=function(e){return new Pa(e).token},Ua=function(e){const t={name:Symbol("VIS.RENDER.EVENT")};return ts.register(t,()=>e),t},Ga=function(e,t){return va(e,t,!1)},Ba=["beforeLoad","loaded","beforeCreate","created","beforeRender","rednered","beforeDispose","disposed"],Ha=class extends I{constructor(e){super(),A(this,"wid",Object(g["a"])()),A(this,"parent",""),A(this,"name"),A(this,"observed",{}),A(this,"options"),A(this,"load",[]),A(this,"render",{}),A(this,"observer",new ja),this.options=e,this.name=`${e.name}-${this.wid.slice(-4)}`}initMixins(){}initLifetimes(){const e=this.options;for(const t of Ba)e[t]&&this.on(t,()=>{e[t]()})}async createLoad(e){const t=this.options,n=t.load;this.emit("beforeLoad"),n&&await e.loadResourcesAsync(n),this.emit("created")}createComputed(){const e=this.options.computed||{};for(const t in e)this.observed[t]=Na(e[t].bind(this.observed))}createRender(e){const t=this.options.render.call(this.observed,Ga,()=>{},Na,Ua,t=>Aa(La(Ca(e.resourceManager.getResourceConfig(t),{fillName:!0}),e=>Ga(e.type,e))));for(const n in t)this.observed[n]=t[n],this.render[n]=!0;for(const n in this.options.resources||{})delete this.observed[n]}createObserved(){const e=this.options,t={},n=e.methods||{};for(const s in n)t[s]=!0;const r=Object.assign(this.observed,e.input,e.data&&e.data(t),n);e.beforeCreate&&e.beforeCreate(r),this.observed=rn(r,t)}createResources(e){const t=this.options.resources;t&&e.registerResources(t.call(this.observed))}initObserver(){this.observer.watch(this.observed),this.options.created&&this.options.created.call(this.observed)}createWatch(){const e=this.options.watch||{};for(const t in e){const n=e[t];let r;if("object"===typeof n){if(n.immediate){let e=this.observed;const r=t.split("."),s=r.pop();for(const t of r)e=e[t];const i=e[s];n.handler.call(this.observed,i)}r=n.handler}else r=n;this.observer.subscribe(e=>{const{operate:n,key:s,path:i,value:o}=e;"get"!==n&&t===i&&r.call(this.observed,o)})}}async init(e){const t=this.options;this.initLifetimes(),await this.createLoad(e),this.createObserved(),this.createResources(e),this.createComputed(),this.createRender(e),this.initObserver(),this.emit("beforeRender");const n=e.dataSupportManager,r=va(ee.GROUP);Object.keys(this.render).forEach(e=>{const t=this.observed[e],s=re(t.type);s?(s.toLocaleUpperCase()in ne&&(t.parent||r.children.push(t.vid)),n.applyConfig(t)):console.warn("widget can not support this config type: "+t.type)}),n.applyConfig(r);const s=e.getConfigBySymbol(t.parent);s.children.push(r.vid),this.parent=t.parent,rs.append(()=>(this.createWatch(),this.emit("rendered"),!0))}exportConfig(){}loadConfig(){}};let za=Ha;A(za,"components",{}),A(za,"component",(function(e){Ha.components[e.name]?console.warn(e.name+" components has exist"):Ha.components[e.name]=e}));const ka="0.3.1";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=ka,r["jc"].prototype.add=function(...e){if(!arguments.length)return this;if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}const t=e[0];if(t===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this;if(t&&t.isObject3D){if(null!==t.parent){const e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent({type:"removed"}))}t.parent=this,this.children.push(t),t.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this};const Fa=r["jc"].prototype.add,Ya=r["jc"].prototype.remove;r["jc"].prototype.add=function(...e){return Fa.call(this,...e),this.dispatchEvent({type:"afterAdd",objects:e}),this},r["jc"].prototype.remove=function(...e){return Ya.call(this,...e),this.dispatchEvent({type:"afterRemove",objects:e}),this};const _a=new T["a"](new r["Ib"](-256,256,256,-256));_a.autoUpdate=!1,_a.needsUpdate=!1,r["c"].prototype.shadow=_a}}]);